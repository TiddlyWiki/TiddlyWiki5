title: $:/plugins/tiddlywiki/internals/inspect-filter
tags: $:/tags/Macro

\whitespace trim

\procedure inspect-list(jsonList,class:"tc-box")
<$let
	transclusion={{{ [[list-]addsuffix<class>] }}}
>
	<div class=<<class>>>
		<$let
			state=<<qualify "$:/temp/filter-inspector/list">>
			stateFolded={{{ [<state>addsuffix[folded]] }}}
			folded={{{ [<stateFolded>get[text]else[no]match[yes]] }}}
			stateMaxRows={{{ [<state>addsuffix[max-rows]] }}}
			maxRows={{{ [<stateMaxRows>get[text]!match[]else[10]] }}}
			stateScroll={{{ [<state>addsuffix[scroll]] }}}
		>
			<div class="tc-box-header">
				<$button class="tc-btn-invisible" style.fill="inherit">
					<%if [<folded>match[yes]] %>
						<$action-setfield $tiddler=<<stateFolded>> text="no"/>
					<%else%>
						<$action-setfield $tiddler=<<stateFolded>> text="yes"/>
					<%endif%>
					<$text text={{{ [<jsonList>jsonindexes[]count[]] }}}/>
					{{$:/core/images/right-arrow}}
				</$button>
			</div>
			<%if [<folded>!match[yes]] %>
				<div class="tc-box-content">
					<$scrollable class="tc-box-content-list-scollable" bind=<<stateScroll>>>
						<div class="tc-box-content-list">
							<$list filter="[<jsonList>jsonindexes[]nsort[]limit<maxRows>]" variable="indexList">
								<$list-template>
									<div class="tc-box-content-list-item">
										<$text text={{{ [<jsonList>jsonget<indexList>] }}} />
									</div>
								</$list-template>
								<$list-empty>
									<div class="tc-box-content-list-empty">
										(No items)
									</div>
								</$list-empty>
							</$list>
							<%if [<jsonList>jsonindexes[]count[]compare:number:gt<maxRows>] %>
								<div class="tc-box-content-list-more">
									<$button class="tc-btn-invisible" style.fill="inherit">
										<$action-setfield $tiddler=<<stateMaxRows>> text={{{ [<maxRows>add[10]] }}}/>
										{{$:/core/images/chevron-down}}
										<$text text="more"/>
									</$button>
								</div>
							<%endif%>
						</div>
					</$scrollable>
				</div>
			<%endif%>
		</$let>
	</div>
</$let>
\end inspect-list

\procedure inspect-operator(jsonOperator)
<div class="tc-box tc-inspect-operator-box">
	<div class="tc-box-header">
		<span class="">
			<$text text={{{ [<jsonOperator>jsonget[prefix]] }}} />
			<$text text={{{ [<jsonOperator>jsonget[operatorName]] }}} />
		</span>
		<%if [<jsonOperator>jsonindexes[suffixes]length[]compare:number:gt[0]] %>
			<$list filter="[<jsonOperator>jsonindexes[suffixes]nsort[]]" variable="indexSuffix">
				<span class="tc-pill">
					:<$text text={{{ [<jsonOperator>jsonget[suffixes],<indexSuffix>] }}} />
				</span>
			</$list>
		<%endif%>
		<$list filter="[<jsonOperator>jsonindexes[operands]nsort[]]" variable="indexOperand">
			<div class="tc-split-pill">
				<div class="tc-split-pill-top">
					<%if [<jsonOperator>jsonget[parseTree],[operands],<indexOperand>,[variable]match[true]] %>
						<$text text="<"/><$text text={{{ [<jsonOperator>jsonget[parseTree],[operands],<indexOperand>,[text]] }}}/><$text text=">"/>
					<%elseif [<jsonOperator>jsonget[parseTree],[operands],<indexOperand>,[indirect]match[true]] %>
						<$text text="{"/><$text text={{{ [<jsonOperator>jsonget[parseTree],[operands],<indexOperand>,[text]] }}}/><$text text="}"/>
					<%else%>
						<$text text="["/><$text text={{{ [<jsonOperator>jsonget[parseTree],[operands],<indexOperand>,[text]] }}}/><$text text="]"/>
					<%endif%>
				</div>
				<div class="tc-split-pill-bottom">
					<$text text={{{ [<jsonOperator>jsonget[operands],<indexOperand>] }}} />
				</div>
			</div>
		</$list>
	</div>
	<div class="tc-box-content">
		<$transclude $variable="inspect-list" jsonList={{{ [<jsonOperator>jsonextract[input]] }}} class="tc-box tc-inspect-input-box"/>
		<$transclude $variable="inspect-list" jsonList={{{ [<jsonOperator>jsonextract[output]] }}} class="tc-box tc-inspect-output-box"/>
	</div>
</div>
\end inspect-operator

\procedure inspect-operation(jsonOperation,indexOperation)
<div class="tc-box tc-inspect-operation-box">
	<div class="tc-box-header">
		<span class="">Evaluation</span>
		<span class="tc-pill"><$text text=<<indexOperation>> /></span>
	</div>
	<div class="tc-box-content">
		<$list filter="[<jsonOperation>jsonindexes[operators]nsort[]]" variable="indexOperator">
			<$let transclusion={{{ [[operator-]addsuffix<indexOperator>] }}}>
				<$transclude $variable="inspect-operator" jsonOperator={{{ [<jsonOperation>jsonextract[operators],<indexOperator>] }}}/>
			</$let>
		</$list>
	</div>
</div>
\end inspect-operation

\procedure inspect-run(jsonRun)
<div class="tc-box tc-inspect-run-box">
	<div class="tc-box-header">
		<span class="">:<$text text={{{ [<jsonRun>jsonget[prefixName]] }}} /></span>
		<%if [<jsonRun>jsonindexes[suffixes]length[]compare:number:gt[0]] %>
			<$list filter="[<jsonRun>jsonindexes[suffixes]nsort[]]" variable="indexSuffix">
				<span class="tc-pill">
					:<$text text={{{ [<jsonRun>jsonget[suffixes],<indexSuffix>] }}} />
				</span>
			</$list>
		<%endif%>
	</div>
	<div class="tc-box-content">
		<$transclude $variable="inspect-list" jsonList={{{ [<jsonRun>jsonextract[input]] }}} class="tc-box tc-inspect-input-box"/>
		<div class="tc-inspect-operations-wrapper">
			<$list filter="[<jsonRun>jsonindexes[operations]nsort[]]" variable="indexOperation">
				<$let transclusion={{{ [[operation-]addsuffix<indexOperation>] }}}>
					<$transclude $variable="inspect-operation" jsonOperation={{{ [<jsonRun>jsonextract[operations],<indexOperation>] }}} indexOperation=<<indexOperation>>/>
				</$let>
			</$list>
		</div>
		<$transclude $variable="inspect-list" jsonList={{{ [<jsonRun>jsonextract[output]] }}} class="tc-box tc-inspect-output-box">
	</div>
</div>
\end inspect-run

\procedure inspect-filter-output(jsonOutput,orientation:"horizontal")
<$scrollable bind={{{ [<qualify "$:/temp/filter-inspector/">addsuffix<filter>] }}}>
	<div class={{{ tc-inspect-filter-box [<orientation>match[horizontal]then[tc-inspect-filter-box-horizontal]] +[join[ ]] }}}>
		<div class="tc-box">
			<div class="tc-box-header">
				Filter
				<span class="tc-pill"><$text text={{{ [<jsonOutput>jsonget[inputFilter]] }}}/></span>
			</div>
			<div class="tc-box-content">
				<$transclude $variable="inspect-list" jsonList={{{ [<jsonOutput>jsonextract[input]] }}} class="tc-box tc-inspect-input-box"/>
				<$list filter="[<jsonOutput>jsonindexes[runs]nsort[]]" variable="indexRun">
					<$let transclusion={{{ [[run-]addsuffix<indexRun>] }}}>
						<$transclude $variable="inspect-run" jsonRun={{{ [<jsonOutput>jsonextract[runs],<indexRun>] }}}/>
					</$let>
				</$list>
				<$transclude $variable="inspect-list" jsonList={{{ [<jsonOutput>jsonextract[output]] }}} class="tc-box tc-inspect-output-box"/>
			</div>
		</div>
	</div>
</$scrollable>
\end inspect-filter-output

\procedure inspect-filter(filter,inputFilter:"[all[tiddlers]]",orientation:"horizontal")
<$transclude $variable="inspect-filter-output" jsonOutput={{{ [subfilter<inputFilter>inspect<filter>] }}} orientation=<<orientation>> />
\end inspect-filter
