"use strict";var t=require("$:/plugins/tiddlywiki/codemirror-6/lib/lezer-common.js");let e=0;class a{constructor(t,a,i,r){this.name=t,this.set=a,this.base=i,this.modified=r,this.id=e++}toString(){let{name:t}=this;for(let e of this.modified)e.name&&(t=`${e.name}(${t})`);return t}static define(t,e){let i="string"==typeof t?t:"?";if(t instanceof a&&(e=t),null==e?void 0:e.base)throw new Error("Can not derive from a modified tag");let r=new a(i,[],null,[]);if(r.set.push(r),e)for(let t of e.set)r.set.push(t);return r}static defineModifier(t){let e=new r(t);return t=>t.modified.indexOf(e)>-1?t:r.get(t.base||t,t.modified.concat(e).sort((t,e)=>t.id-e.id))}}let i=0;class r{constructor(t){this.name=t,this.instances=[],this.id=i++}static get(t,e){if(!e.length)return t;let i=e[0].instances.find(a=>{return a.base==t&&(i=e,r=a.modified,i.length==r.length&&i.every((t,e)=>t==r[e]));var i,r});if(i)return i;let o=[],s=new a(t.name,o,t,e);for(let t of e)t.instances.push(s);let n=function(t){let e=[[]];for(let a=0;a<t.length;a++)for(let i=0,r=e.length;i<r;i++)e.push(e[i].concat(t[a]));return e.sort((t,e)=>e.length-t.length)}(e);for(let e of t.set)if(!e.modified.length)for(let t of n)o.push(r.get(e,t));return s}}const o=new t.NodeProp({combine(t,e){let a,i,r;for(;t||e;){if(!t||e&&t.depth>=e.depth?(r=e,e=e.next):(r=t,t=t.next),a&&a.mode==r.mode&&!r.context&&!a.context)continue;let o=new s(r.tags,r.mode,r.context);a?a.next=o:i=o,a=o}return i}});class s{constructor(t,e,a,i){this.tags=t,this.mode=e,this.context=a,this.next=i}get opaque(){return 0==this.mode}get inherit(){return 1==this.mode}sort(t){return!t||t.depth<this.depth?(this.next=t,this):(t.next=this.sort(t.next),t)}get depth(){return this.context?this.context.length:0}}function n(t,e){let a=Object.create(null);for(let e of t)if(Array.isArray(e.tag))for(let t of e.tag)a[t.id]=e.class;else a[e.tag.id]=e.class;let{scope:i,all:r=null}=e||{};return{style:t=>{let e=r;for(let i of t)for(let t of i.set){let i=a[t.id];if(i){e=e?e+" "+i:i;break}}return e},scope:i}}function l(t,e,a,i=0,r=t.length){let o=new c(i,Array.isArray(e)?e:[e],a);o.highlightRange(t.cursor(),i,r,"",o.highlighters),o.flush(r)}s.empty=new s([],2,null);class c{constructor(t,e,a){this.at=t,this.highlighters=e,this.span=a,this.class=""}startSpan(t,e){e!=this.class&&(this.flush(t),t>this.at&&(this.at=t),this.class=e)}flush(t){t>this.at&&this.class&&this.span(this.at,t,this.class)}highlightRange(e,a,i,r,o){let{type:n,from:l,to:c}=e;if(l>=i||c<=a)return;n.isTop&&(o=this.highlighters.filter(t=>!t.scope||t.scope(n)));let g=r,f=h(e)||s.empty,d=function(t,e){let a=null;for(let i of t){let t=i.style(e);t&&(a=a?a+" "+t:t)}return a}(o,f.tags);if(d&&(g&&(g+=" "),g+=d,1==f.mode&&(r+=(r?" ":"")+d)),this.startSpan(Math.max(a,l),g),f.opaque)return;let m=e.tree&&e.tree.prop(t.NodeProp.mounted);if(m&&m.overlay){let t=e.node.enter(m.overlay[0].from+l,1),s=this.highlighters.filter(t=>!t.scope||t.scope(m.tree.type)),n=e.firstChild();for(let h=0,f=l;;h++){let d=h<m.overlay.length?m.overlay[h]:null,p=d?d.from+l:c,u=Math.max(a,f),k=Math.min(i,p);if(u<k&&n)for(;e.from<k&&(this.highlightRange(e,u,k,r,o),this.startSpan(Math.min(k,e.to),g),!(e.to>=p)&&e.nextSibling()););if(!d||p>i)break;f=d.to+l,f>a&&(this.highlightRange(t.cursor(),Math.max(a,d.from+l),Math.min(i,f),"",s),this.startSpan(Math.min(i,f),g))}n&&e.parent()}else if(e.firstChild()){m&&(r="");do{if(!(e.to<=a)){if(e.from>=i)break;this.highlightRange(e,a,i,r,o),this.startSpan(Math.min(i,e.to),g)}}while(e.nextSibling());e.parent()}}}function h(t){let e=t.type.prop(o);for(;e&&e.context&&!t.matchContext(e.context);)e=e.next;return e||null}const g=a.define,f=g(),d=g(),m=g(d),p=g(d),u=g(),k=g(u),b=g(u),y=g(),x=g(y),N=g(),w=g(),v=g(),M=g(v),O=g(),S={comment:f,lineComment:g(f),blockComment:g(f),docComment:g(f),name:d,variableName:g(d),typeName:m,tagName:g(m),propertyName:p,attributeName:g(p),className:g(d),labelName:g(d),namespace:g(d),macroName:g(d),literal:u,string:k,docString:g(k),character:g(k),attributeValue:g(k),number:b,integer:g(b),float:g(b),bool:g(u),regexp:g(u),escape:g(u),color:g(u),url:g(u),keyword:N,self:g(N),null:g(N),atom:g(N),unit:g(N),modifier:g(N),operatorKeyword:g(N),controlKeyword:g(N),definitionKeyword:g(N),moduleKeyword:g(N),operator:w,derefOperator:g(w),arithmeticOperator:g(w),logicOperator:g(w),bitwiseOperator:g(w),compareOperator:g(w),updateOperator:g(w),definitionOperator:g(w),typeOperator:g(w),controlOperator:g(w),punctuation:v,separator:g(v),bracket:M,angleBracket:g(M),squareBracket:g(M),paren:g(M),brace:g(M),content:y,heading:x,heading1:g(x),heading2:g(x),heading3:g(x),heading4:g(x),heading5:g(x),heading6:g(x),contentSeparator:g(y),list:g(y),quote:g(y),emphasis:g(y),strong:g(y),link:g(y),monospace:g(y),strikethrough:g(y),inserted:g(),deleted:g(),changed:g(),invalid:g(),meta:O,documentMeta:g(O),annotation:g(O),processingInstruction:g(O),definition:a.defineModifier("definition"),constant:a.defineModifier("constant"),function:a.defineModifier("function"),standard:a.defineModifier("standard"),local:a.defineModifier("local"),special:a.defineModifier("special")};for(let t in S){let e=S[t];e instanceof a&&(e.name=t)}const C=n([{tag:S.link,class:"tok-link"},{tag:S.heading,class:"tok-heading"},{tag:S.emphasis,class:"tok-emphasis"},{tag:S.strong,class:"tok-strong"},{tag:S.keyword,class:"tok-keyword"},{tag:S.atom,class:"tok-atom"},{tag:S.bool,class:"tok-bool"},{tag:S.url,class:"tok-url"},{tag:S.labelName,class:"tok-labelName"},{tag:S.inserted,class:"tok-inserted"},{tag:S.deleted,class:"tok-deleted"},{tag:S.literal,class:"tok-literal"},{tag:S.string,class:"tok-string"},{tag:S.number,class:"tok-number"},{tag:[S.regexp,S.escape,S.special(S.string)],class:"tok-string2"},{tag:S.variableName,class:"tok-variableName"},{tag:S.local(S.variableName),class:"tok-variableName tok-local"},{tag:S.definition(S.variableName),class:"tok-variableName tok-definition"},{tag:S.special(S.variableName),class:"tok-variableName2"},{tag:S.definition(S.propertyName),class:"tok-propertyName tok-definition"},{tag:S.typeName,class:"tok-typeName"},{tag:S.namespace,class:"tok-namespace"},{tag:S.className,class:"tok-className"},{tag:S.macroName,class:"tok-macroName"},{tag:S.propertyName,class:"tok-propertyName"},{tag:S.operator,class:"tok-operator"},{tag:S.comment,class:"tok-comment"},{tag:S.meta,class:"tok-meta"},{tag:S.invalid,class:"tok-invalid"},{tag:S.punctuation,class:"tok-punctuation"}]);exports.Tag=a,exports.classHighlighter=C,exports.getStyleTags=h,exports.highlightCode=function(t,e,a,i,r,o=0,s=t.length){let n=o;function c(e,a){if(!(e<=n)){for(let o=t.slice(n,e),s=0;;){let t=o.indexOf("\n",s),e=t<0?o.length:t;if(e>s&&i(o.slice(s,e),a),t<0)break;r(),s=t+1}n=e}}l(e,a,(t,e,a)=>{c(t,""),c(e,a)},o,s),c(s,"")},exports.highlightTree=l,exports.styleTags=function(t){let e=Object.create(null);for(let a in t){let i=t[a];Array.isArray(i)||(i=[i]);for(let t of a.split(" "))if(t){let a=[],r=2,o=t;for(let e=0;;){if("..."==o&&e>0&&e+3==t.length){r=1;break}let i=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(o);if(!i)throw new RangeError("Invalid path: "+t);if(a.push("*"==i[0]?"":'"'==i[0][0]?JSON.parse(i[0]):i[0]),e+=i[0].length,e==t.length)break;let s=t[e++];if(e==t.length&&"!"==s){r=0;break}if("/"!=s)throw new RangeError("Invalid path: "+t);o=t.slice(e)}let n=a.length-1,l=a[n];if(!l)throw new RangeError("Invalid path: "+t);let c=new s(i,r,n>0?a.slice(0,n):null);e[l]=c.sort(e[l])}}return o.add(e)},exports.tagHighlighter=n,exports.tags=S;
