"use strict";var t=require("$:/plugins/tiddlywiki/codemirror-6/lib/lezer-common.js"),e=require("$:/plugins/tiddlywiki/codemirror-6/lib/codemirror-state.js"),r=require("$:/plugins/tiddlywiki/codemirror-6/lib/codemirror-view.js"),n=require("$:/plugins/tiddlywiki/codemirror-6/lib/lezer-highlight.js");const s="undefined"==typeof Symbol?"__ͼ":Symbol.for("ͼ"),o="undefined"==typeof Symbol?"__styleSet"+Math.floor(1e8*Math.random()):Symbol("styleSet"),i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:{};class a{constructor(t,e){this.rules=[];let{finish:r}=e||{};function n(t){return/^@/.test(t)?[t]:t.split(/,\s*/)}function s(t,e,o,i){let a=[],l=/^@(\w+)\b/.exec(t[0]),h=l&&"keyframes"==l[1];if(l&&null==e)return o.push(t[0]+";");for(let r in e){let i=e[r];if(/&/.test(r))s(r.split(/,\s*/).map(e=>t.map(t=>e.replace(/&/,t))).reduce((t,e)=>t.concat(e)),i,o);else if(i&&"object"==typeof i){if(!l)throw new RangeError("The value of a property ("+r+") should be a primitive value.");s(n(r),i,a,h)}else null!=i&&a.push(r.replace(/_.*/,"").replace(/[A-Z]/g,t=>"-"+t.toLowerCase())+": "+i+";")}(a.length||h)&&o.push((!r||l||i?t:t.map(r)).join(", ")+" {"+a.join(" ")+"}")}for(let e in t)s(n(e),t[e],this.rules)}getRules(){return this.rules.join("\n")}static newName(){let t=i[s]||1;return i[s]=t+1,"ͼ"+t.toString(36)}static mount(t,e,r){let n=t[o],s=r&&r.nonce;n?s&&n.setNonce(s):n=new h(t,s),n.mount(Array.isArray(e)?e:[e],t)}}let l=new Map;class h{constructor(t,e){let r=t.ownerDocument||t,n=r.defaultView;if(!t.head&&t.adoptedStyleSheets&&n.CSSStyleSheet){let e=l.get(r);if(e)return t[o]=e;this.sheet=new n.CSSStyleSheet,l.set(r,this)}else this.styleTag=r.createElement("style"),e&&this.styleTag.setAttribute("nonce",e);this.modules=[],t[o]=this}mount(t,e){let r=this.sheet,n=0,s=0;for(let e=0;e<t.length;e++){let o=t[e],i=this.modules.indexOf(o);if(i<s&&i>-1&&(this.modules.splice(i,1),s--,i=-1),-1==i){if(this.modules.splice(s++,0,o),r)for(let t=0;t<o.rules.length;t++)r.insertRule(o.rules[t],n++)}else{for(;s<i;)n+=this.modules[s++].rules.length;n+=o.rules.length,s++}}if(r)e.adoptedStyleSheets.indexOf(this.sheet)<0&&(e.adoptedStyleSheets=[this.sheet,...e.adoptedStyleSheets]);else{let t="";for(let e=0;e<this.modules.length;e++)t+=this.modules[e].getRules()+"\n";this.styleTag.textContent=t;let r=e.head||e;this.styleTag.parentNode!=r&&r.insertBefore(this.styleTag,r.firstChild)}}setNonce(t){this.styleTag&&this.styleTag.getAttribute("nonce")!=t&&this.styleTag.setAttribute("nonce",t)}}var u;const c=new t.NodeProp;function f(t){return e.Facet.define({combine:t?e=>e.concat(t):void 0})}const d=new t.NodeProp;class p{constructor(t,r,n=[],s=""){this.data=t,this.name=s,e.EditorState.prototype.hasOwnProperty("tree")||Object.defineProperty(e.EditorState.prototype,"tree",{get(){return k(this)}}),this.parser=r,this.extension=[C.of(this),e.EditorState.languageData.of((t,e,r)=>{let n=g(t,e,r),s=n.type.prop(c);if(!s)return[];let o=t.facet(s),i=n.type.prop(d);if(i){let s=n.resolve(e-n.from,r);for(let e of i)if(e.test(s,t)){let r=t.facet(e.facet);return"replace"==e.type?r:r.concat(o)}}return o})].concat(n)}isActiveAt(t,e,r=-1){return g(t,e,r).type.prop(c)==this.data}findRegions(e){let r=e.facet(C);if((null==r?void 0:r.data)==this.data)return[{from:0,to:e.doc.length}];if(!r||!r.allowsNesting)return[];let n=[],s=(e,r)=>{if(e.prop(c)==this.data)return void n.push({from:r,to:r+e.length});let o=e.prop(t.NodeProp.mounted);if(o){if(o.tree.prop(c)==this.data){if(o.overlay)for(let t of o.overlay)n.push({from:t.from+r,to:t.to+r});else n.push({from:r,to:r+e.length});return}if(o.overlay){let t=n.length;if(s(o.tree,o.overlay[0].from+r),n.length>t)return}}for(let n=0;n<e.children.length;n++){let o=e.children[n];o instanceof t.Tree&&s(o,e.positions[n]+r)}};return s(k(e),0),n}get allowsNesting(){return!0}}function g(e,r,n){let s=e.facet(C),o=k(e).topNode;if(!s||s.allowsNesting)for(let e=o;e;e=e.enter(r,n,t.IterMode.ExcludeBuffers|t.IterMode.EnterBracketed))e.type.isTop&&(o=e);return o}p.setState=e.StateEffect.define();class m extends p{constructor(t,e,r){super(t,e,[],r),this.parser=e}static define(t){let e=f(t.languageData);return new m(e,t.parser.configure({props:[c.add(t=>t.isTop?e:void 0)]}),t.name)}configure(t,e){return new m(this.data,this.parser.configure(t),e||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function k(e){let r=e.field(p.state,!1);return r?r.tree:t.Tree.empty}function w(t,e,r=50){var n;let s=null===(n=t.field(p.state,!1))||void 0===n?void 0:n.context;if(!s)return null;let o=s.viewport;s.updateViewport({from:0,to:e});let i=s.isDone(e)||s.work(r,e)?s.tree:null;return s.updateViewport(o),i}class x{constructor(t){this.doc=t,this.cursorPos=0,this.string="",this.cursor=t.iter()}get length(){return this.doc.length}syncTo(t){return this.string=this.cursor.next(t-this.cursorPos).value,this.cursorPos=t+this.string.length,this.cursorPos-this.string.length}chunk(t){return this.syncTo(t),this.string}get lineChunks(){return!0}read(t,e){let r=this.cursorPos-this.string.length;return t<r||e>=this.cursorPos?this.doc.sliceString(t,e):this.string.slice(t-r,e-r)}}let v=null;class y{constructor(t,e,r=[],n,s,o,i,a){this.parser=t,this.state=e,this.fragments=r,this.tree=n,this.treeLen=s,this.viewport=o,this.skipped=i,this.scheduleOn=a,this.parse=null,this.tempSkipped=[]}static create(e,r,n){return new y(e,r,[],t.Tree.empty,0,n,[],null)}startParse(){return this.parser.startParse(new x(this.state.doc),this.fragments)}work(e,r){return null!=r&&r>=this.state.doc.length&&(r=void 0),this.tree!=t.Tree.empty&&this.isDone(null!=r?r:this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var n;if("number"==typeof e){let t=Date.now()+e;e=()=>Date.now()>t}for(this.parse||(this.parse=this.startParse()),null!=r&&(null==this.parse.stoppedAt||this.parse.stoppedAt>r)&&r<this.state.doc.length&&this.parse.stopAt(r);;){let s=this.parse.advance();if(s){if(this.fragments=this.withoutTempSkipped(t.TreeFragment.addTree(s,this.fragments,null!=this.parse.stoppedAt)),this.treeLen=null!==(n=this.parse.stoppedAt)&&void 0!==n?n:this.state.doc.length,this.tree=s,this.parse=null,!(this.treeLen<(null!=r?r:this.state.doc.length)))return!0;this.parse=this.startParse()}if(e())return!1}})}takeTree(){let e,r;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((null==this.parse.stoppedAt||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(r=this.parse.advance()););}),this.treeLen=e,this.tree=r,this.fragments=this.withoutTempSkipped(t.TreeFragment.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(t){let e=v;v=this;try{return t()}finally{v=e}}withoutTempSkipped(t){for(let e;e=this.tempSkipped.pop();)t=b(t,e.from,e.to);return t}changes(e,r){let{fragments:n,tree:s,treeLen:o,viewport:i,skipped:a}=this;if(this.takeTree(),!e.empty){let r=[];if(e.iterChangedRanges((t,e,n,s)=>r.push({fromA:t,toA:e,fromB:n,toB:s})),n=t.TreeFragment.applyChanges(n,r),s=t.Tree.empty,o=0,i={from:e.mapPos(i.from,-1),to:e.mapPos(i.to,1)},this.skipped.length){a=[];for(let t of this.skipped){let r=e.mapPos(t.from,1),n=e.mapPos(t.to,-1);r<n&&a.push({from:r,to:n})}}}return new y(this.parser,r,n,s,o,i,a,this.scheduleOn)}updateViewport(t){if(this.viewport.from==t.from&&this.viewport.to==t.to)return!1;this.viewport=t;let e=this.skipped.length;for(let e=0;e<this.skipped.length;e++){let{from:r,to:n}=this.skipped[e];r<t.to&&n>t.from&&(this.fragments=b(this.fragments,r,n),this.skipped.splice(e--,1))}return!(this.skipped.length>=e)&&(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(t,e){this.skipped.push({from:t,to:e})}static getSkippingParser(e){return new class extends t.Parser{createParse(r,n,s){let o=s[0].from,i=s[s.length-1].to;return{parsedPos:o,advance(){let r=v;if(r){for(let t of s)r.tempSkipped.push(t);e&&(r.scheduleOn=r.scheduleOn?Promise.all([r.scheduleOn,e]):e)}return this.parsedPos=i,new t.Tree(t.NodeType.none,[],[],i-o)},stoppedAt:null,stopAt(){}}}}}isDone(t){t=Math.min(t,this.state.doc.length);let e=this.fragments;return this.treeLen>=t&&e.length&&0==e[0].from&&e[0].to>=t}static get(){return v}}function b(e,r,n){return t.TreeFragment.applyChanges(e,[{fromA:r,toA:n,fromB:r,toB:n}])}class S{constructor(t){this.context=t,this.tree=t.tree}apply(t){if(!t.docChanged&&this.tree==this.context.tree)return this;let e=this.context.changes(t.changes,t.state),r=this.context.treeLen==t.startState.doc.length?void 0:Math.max(t.changes.mapPos(this.context.treeLen),e.viewport.to);return e.work(20,r)||e.takeTree(),new S(e)}static init(t){let e=Math.min(3e3,t.doc.length),r=y.create(t.facet(C).parser,t,{from:0,to:e});return r.work(20,e)||r.takeTree(),new S(r)}}p.state=e.StateField.define({create:S.init,update(t,e){for(let t of e.effects)if(t.is(p.setState))return t.value;return e.startState.facet(C)!=e.state.facet(C)?S.init(e.state):t.apply(e)}});let T=t=>{let e=setTimeout(()=>t(),500);return()=>clearTimeout(e)};"undefined"!=typeof requestIdleCallback&&(T=t=>{let e=-1,r=setTimeout(()=>{e=requestIdleCallback(t,{timeout:400})},100);return()=>e<0?clearTimeout(r):cancelIdleCallback(e)});const P="undefined"!=typeof navigator&&(null===(u=navigator.scheduling)||void 0===u?void 0:u.isInputPending)?()=>navigator.scheduling.isInputPending():null,A=r.ViewPlugin.fromClass(class{constructor(t){this.view=t,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(t){let e=this.view.state.field(p.state).context;(e.updateViewport(t.view.viewport)||this.view.viewport.to>e.treeLen)&&this.scheduleWork(),(t.docChanged||t.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(e)}scheduleWork(){if(this.working)return;let{state:t}=this.view,e=t.field(p.state);e.tree==e.context.tree&&e.context.isDone(t.doc.length)||(this.working=T(this.work))}work(t){this.working=null;let e=Date.now();if(this.chunkEnd<e&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=e+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:r,viewport:{to:n}}=this.view,s=r.field(p.state);if(s.tree==s.context.tree&&s.context.isDone(n+1e5))return;let o=Date.now()+Math.min(this.chunkBudget,100,t&&!P?Math.max(25,t.timeRemaining()-5):1e9),i=s.context.treeLen<n&&r.doc.length>n+1e3,a=s.context.work(()=>P&&P()||Date.now()>o,n+(i?0:1e5));this.chunkBudget-=Date.now()-e,(a||this.chunkBudget<=0)&&(s.context.takeTree(),this.view.dispatch({effects:p.setState.of(new S(s.context))})),this.chunkBudget>0&&(!a||i)&&this.scheduleWork(),this.checkAsyncSchedule(s.context)}checkAsyncSchedule(t){t.scheduleOn&&(this.workScheduled++,t.scheduleOn.then(()=>this.scheduleWork()).catch(t=>r.logException(this.view.state,t)).then(()=>this.workScheduled--),t.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),C=e.Facet.define({combine:t=>t.length?t[0]:null,enables:t=>[p.state,A,r.EditorView.contentAttributes.compute([t],e=>{let r=e.facet(t);return r&&r.name?{"data-language":r.name}:{}})]});class D{constructor(t,e,r,n,s,o=void 0){this.name=t,this.alias=e,this.extensions=r,this.filename=n,this.loadFunc=s,this.support=o,this.loading=null}load(){return this.loading||(this.loading=this.loadFunc().then(t=>this.support=t,t=>{throw this.loading=null,t}))}static of(t){let{load:e,support:r}=t;if(!e){if(!r)throw new RangeError("Must pass either 'load' or 'support' to LanguageDescription.of");e=()=>Promise.resolve(r)}return new D(t.name,(t.alias||[]).concat(t.name).map(t=>t.toLowerCase()),t.extensions||[],t.filename,e,r)}static matchFilename(t,e){for(let r of t)if(r.filename&&r.filename.test(e))return r;let r=/\.([^.]+)$/.exec(e);if(r)for(let e of t)if(e.extensions.indexOf(r[1])>-1)return e;return null}static matchLanguageName(t,e,r=!0){e=e.toLowerCase();for(let r of t)if(r.alias.some(t=>t==e))return r;if(r)for(let r of t)for(let t of r.alias){let n=e.indexOf(t);if(n>-1&&(t.length>2||!/\w/.test(e[n-1])&&!/\w/.test(e[n+t.length])))return r}return null}}const I=e.Facet.define(),N=e.Facet.define({combine:t=>{if(!t.length)return"  ";let e=t[0];if(!e||/\S/.test(e)||Array.from(e).some(t=>t!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(t[0]));return e}});function E(t){let e=t.facet(N);return 9==e.charCodeAt(0)?t.tabSize*e.length:e.length}function O(t,e){let r="",n=t.tabSize,s=t.facet(N)[0];if("\t"==s){for(;e>=n;)r+="\t",e-=n;s=" "}for(let t=0;t<e;t++)r+=s;return r}function B(t,r){t instanceof e.EditorState&&(t=new L(t));for(let e of t.state.facet(I)){let n=e(t,r);if(void 0!==n)return n}let n=k(t.state);return n.length>=r?function(t,e,r){let n=e.resolveStack(r),s=e.resolveInner(r,-1).resolve(r,0).enterUnfinishedNodesBefore(r);if(s!=n.node){let t=[];for(let e=s;e&&!(e.from<n.node.from||e.to>n.node.to||e.from==n.node.from&&e.type==n.node.type);e=e.parent)t.push(e);for(let e=t.length-1;e>=0;e--)n={node:t[e],next:n}}return M(n,t,r)}(t,n,r):null}class L{constructor(t,e={}){this.state=t,this.options=e,this.unit=E(t)}lineAt(t,e=1){let r=this.state.doc.lineAt(t),{simulateBreak:n,simulateDoubleBreak:s}=this.options;return null!=n&&n>=r.from&&n<=r.to?s&&n==t?{text:"",from:t}:(e<0?n<t:n<=t)?{text:r.text.slice(n-r.from),from:n}:{text:r.text.slice(0,n-r.from),from:r.from}:r}textAfterPos(t,e=1){if(this.options.simulateDoubleBreak&&t==this.options.simulateBreak)return"";let{text:r,from:n}=this.lineAt(t,e);return r.slice(t-n,Math.min(r.length,t+100-n))}column(t,e=1){let{text:r,from:n}=this.lineAt(t,e),s=this.countColumn(r,t-n),o=this.options.overrideIndentation?this.options.overrideIndentation(n):-1;return o>-1&&(s+=o-this.countColumn(r,r.search(/\S|$/))),s}countColumn(t,r=t.length){return e.countColumn(t,this.state.tabSize,r)}lineIndent(t,e=1){let{text:r,from:n}=this.lineAt(t,e),s=this.options.overrideIndentation;if(s){let t=s(n);if(t>-1)return t}return this.countColumn(r,r.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const R=new t.NodeProp;function M(t,e,r){for(let n=t;n;n=n.next){let t=F(n.node);if(t)return t(j.create(e,r,n))}return 0}function F(e){let r=e.type.prop(R);if(r)return r;let n,s=e.firstChild;if(s&&(n=s.type.prop(t.NodeProp.closedBy))){let t=e.lastChild,r=t&&n.indexOf(t.name)>-1;return e=>U(e,!0,1,void 0,r&&!function(t){return t.pos==t.options.simulateBreak&&t.options.simulateDoubleBreak}(e)?t.from:void 0)}return null==e.parent?V:null}function V(){return 0}class j extends L{constructor(t,e,r){super(t.state,t.options),this.base=t,this.pos=e,this.context=r}get node(){return this.context.node}static create(t,e,r){return new j(t,e,r)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(t){let e=this.state.doc.lineAt(t.from);for(;;){let r=t.resolve(e.from);for(;r.parent&&r.parent.from==r.from;)r=r.parent;if(W(r,t))break;e=this.state.doc.lineAt(r.from)}return this.lineIndent(e.from)}continue(){return M(this.context.next,this.base,this.pos)}}function W(t,e){for(let r=e;r;r=r.parent)if(t==r)return!0;return!1}function U(t,e,r,n,s){let o=t.textAfter,i=o.match(/^\s*/)[0].length,a=n&&o.slice(i,i+n.length)==n||s==t.pos+i,l=e?function(t){let e=t.node,r=e.childAfter(e.from),n=e.lastChild;if(!r)return null;let s=t.options.simulateBreak,o=t.state.doc.lineAt(r.from),i=null==s||s<=o.from?o.to:Math.min(o.to,s);for(let t=r.to;;){let s=e.childAfter(t);if(!s||s==n)return null;if(!s.type.isSkipped){if(s.from>=i)return null;let t=/^ */.exec(o.text.slice(r.to-o.from))[0].length;return{from:r.from,to:r.to+t}}t=s.to}}(t):null;return l?a?t.column(l.from):t.column(l.to):t.baseIndent+(a?0:t.unit*r)}const $=e.Facet.define(),z=new t.NodeProp;function q(t){let e=t.lastChild;return e&&e.to==t.to&&e.type.isError}function H(t,e,r){for(let n of t.facet($)){let s=n(t,e,r);if(s)return s}return function(t,e,r){let n=k(t);if(n.length<r)return null;let s=null;for(let o=n.resolveStack(r,1);o;o=o.next){let i=o.node;if(i.to<=r||i.from>r)continue;if(s&&i.from<e)break;let a=i.type.prop(z);if(a&&(i.to<n.length-50||n.length==t.doc.length||!q(i))){let n=a(i,t);n&&n.from<=r&&n.from>=e&&n.to>r&&(s=n)}}return s}(t,e,r)}function G(t,e){let r=e.mapPos(t.from,1),n=e.mapPos(t.to,-1);return r>=n?void 0:{from:r,to:n}}const _=e.StateEffect.define({map:G}),J=e.StateEffect.define({map:G});function K(t){let e=[];for(let{head:r}of t.state.selection.ranges)e.some(t=>t.from<=r&&t.to>=r)||e.push(t.lineBlockAt(r));return e}const Z=e.StateField.define({create:()=>r.Decoration.none,update(t,e){e.isUserEvent("delete")&&e.changes.iterChangedRanges((e,r)=>t=Q(t,e,r)),t=t.map(e.changes);for(let n of e.effects)if(n.is(_)&&!Y(t,n.value.from,n.value.to)){let{preparePlaceholder:s}=e.state.facet(ht),o=s?r.Decoration.replace({widget:new dt(s(e.state,n.value))}):ft;t=t.update({add:[o.range(n.value.from,n.value.to)]})}else n.is(J)&&(t=t.update({filter:(t,e)=>n.value.from!=t||n.value.to!=e,filterFrom:n.value.from,filterTo:n.value.to}));return e.selection&&(t=Q(t,e.selection.main.head)),t},provide:t=>r.EditorView.decorations.from(t),toJSON(t,e){let r=[];return t.between(0,e.doc.length,(t,e)=>{r.push(t,e)}),r},fromJSON(t){if(!Array.isArray(t)||t.length%2)throw new RangeError("Invalid JSON for fold state");let e=[];for(let r=0;r<t.length;){let n=t[r++],s=t[r++];if("number"!=typeof n||"number"!=typeof s)throw new RangeError("Invalid JSON for fold state");e.push(ft.range(n,s))}return r.Decoration.set(e,!0)}});function Q(t,e,r=e){let n=!1;return t.between(e,r,(t,s)=>{t<r&&s>e&&(n=!0)}),n?t.update({filterFrom:e,filterTo:r,filter:(t,n)=>t>=r||n<=e}):t}function X(t,e,r){var n;let s=null;return null===(n=t.field(Z,!1))||void 0===n||n.between(e,r,(t,e)=>{(!s||s.from>t)&&(s={from:t,to:e})}),s}function Y(t,e,r){let n=!1;return t.between(e,e,(t,s)=>{t==e&&s==r&&(n=!0)}),n}function tt(t,r){return t.field(Z,!1)?r:r.concat(e.StateEffect.appendConfig.of(ut()))}const et=t=>{for(let e of K(t)){let r=H(t.state,e.from,e.to);if(r)return t.dispatch({effects:tt(t.state,[_.of(r),nt(t,r)])}),!0}return!1},rt=t=>{if(!t.state.field(Z,!1))return!1;let e=[];for(let r of K(t)){let n=X(t.state,r.from,r.to);n&&e.push(J.of(n),nt(t,n,!1))}return e.length&&t.dispatch({effects:e}),e.length>0};function nt(t,e,n=!0){let s=t.state.doc.lineAt(e.from).number,o=t.state.doc.lineAt(e.to).number;return r.EditorView.announce.of(`${t.state.phrase(n?"Folded lines":"Unfolded lines")} ${s} ${t.state.phrase("to")} ${o}.`)}const st=t=>{let{state:e}=t,r=[];for(let n=0;n<e.doc.length;){let s=t.lineBlockAt(n),o=H(e,s.from,s.to);o&&r.push(_.of(o)),n=(o?t.lineBlockAt(o.to):s).to+1}return r.length&&t.dispatch({effects:tt(t.state,r)}),!!r.length},ot=t=>{let e=t.state.field(Z,!1);if(!e||!e.size)return!1;let r=[];return e.between(0,t.state.doc.length,(t,e)=>{r.push(J.of({from:t,to:e}))}),t.dispatch({effects:r}),!0};function it(t,e){for(let r=e;;){let n=H(t.state,r.from,r.to);if(n&&n.to>e.from)return n;if(!r.from)return null;r=t.lineBlockAt(r.from-1)}}const at=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:et},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:rt},{key:"Ctrl-Alt-[",run:st},{key:"Ctrl-Alt-]",run:ot}],lt={placeholderDOM:null,preparePlaceholder:null,placeholderText:"…"},ht=e.Facet.define({combine:t=>e.combineConfig(t,lt)});function ut(t){let e=[Z,mt];return t&&e.push(ht.of(t)),e}function ct(t,e){let{state:r}=t,n=r.facet(ht),s=e=>{let r=t.lineBlockAt(t.posAtDOM(e.target)),n=X(t.state,r.from,r.to);n&&t.dispatch({effects:J.of(n)}),e.preventDefault()};if(n.placeholderDOM)return n.placeholderDOM(t,s,e);let o=document.createElement("span");return o.textContent=n.placeholderText,o.setAttribute("aria-label",r.phrase("folded code")),o.title=r.phrase("unfold"),o.className="cm-foldPlaceholder",o.onclick=s,o}const ft=r.Decoration.replace({widget:new class extends r.WidgetType{toDOM(t){return ct(t,null)}}});class dt extends r.WidgetType{constructor(t){super(),this.value=t}eq(t){return this.value==t.value}toDOM(t){return ct(t,this.value)}}const pt={openText:"⌄",closedText:"›",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class gt extends r.GutterMarker{constructor(t,e){super(),this.config=t,this.open=e}eq(t){return this.config==t.config&&this.open==t.open}toDOM(t){if(this.config.markerDOM)return this.config.markerDOM(this.open);let e=document.createElement("span");return e.textContent=this.open?this.config.openText:this.config.closedText,e.title=t.state.phrase(this.open?"Fold line":"Unfold line"),e}}const mt=r.EditorView.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class kt{constructor(t,e){let r;function s(t){let e=a.newName();return(r||(r=Object.create(null)))["."+e]=t,e}this.specs=t;const o="string"==typeof e.all?e.all:e.all?s(e.all):void 0,i=e.scope;this.scope=i instanceof p?t=>t.prop(c)==i.data:i?t=>t==i:void 0,this.style=n.tagHighlighter(t.map(t=>({tag:t.tag,class:t.class||s(Object.assign({},t,{tag:null}))})),{all:o}).style,this.module=r?new a(r):null,this.themeType=e.themeType}static define(t,e){return new kt(t,e||{})}}const wt=e.Facet.define(),xt=e.Facet.define({combine:t=>t.length?[t[0]]:null});function vt(t){let e=t.facet(wt);return e.length?e:t.facet(xt)}class yt{constructor(t){this.markCache=Object.create(null),this.tree=k(t.state),this.decorations=this.buildDeco(t,vt(t.state)),this.decoratedTo=t.viewport.to}update(t){let e=k(t.state),r=vt(t.state),n=r!=vt(t.startState),{viewport:s}=t.view,o=t.changes.mapPos(this.decoratedTo,1);e.length<s.to&&!n&&e.type==this.tree.type&&o>=s.to?(this.decorations=this.decorations.map(t.changes),this.decoratedTo=o):(e!=this.tree||t.viewportChanged||n)&&(this.tree=e,this.decorations=this.buildDeco(t.view,r),this.decoratedTo=s.to)}buildDeco(t,s){if(!s||!this.tree.length)return r.Decoration.none;let o=new e.RangeSetBuilder;for(let{from:e,to:i}of t.visibleRanges)n.highlightTree(this.tree,s,(t,e,n)=>{o.add(t,e,this.markCache[n]||(this.markCache[n]=r.Decoration.mark({class:n})))},e,i);return o.finish()}}const bt=e.Prec.high(r.ViewPlugin.fromClass(yt,{decorations:t=>t.decorations})),St=kt.define([{tag:n.tags.meta,color:"#404740"},{tag:n.tags.link,textDecoration:"underline"},{tag:n.tags.heading,textDecoration:"underline",fontWeight:"bold"},{tag:n.tags.emphasis,fontStyle:"italic"},{tag:n.tags.strong,fontWeight:"bold"},{tag:n.tags.strikethrough,textDecoration:"line-through"},{tag:n.tags.keyword,color:"#708"},{tag:[n.tags.atom,n.tags.bool,n.tags.url,n.tags.contentSeparator,n.tags.labelName],color:"#219"},{tag:[n.tags.literal,n.tags.inserted],color:"#164"},{tag:[n.tags.string,n.tags.deleted],color:"#a11"},{tag:[n.tags.regexp,n.tags.escape,n.tags.special(n.tags.string)],color:"#e40"},{tag:n.tags.definition(n.tags.variableName),color:"#00f"},{tag:n.tags.local(n.tags.variableName),color:"#30a"},{tag:[n.tags.typeName,n.tags.namespace],color:"#085"},{tag:n.tags.className,color:"#167"},{tag:[n.tags.special(n.tags.variableName),n.tags.macroName],color:"#256"},{tag:n.tags.definition(n.tags.propertyName),color:"#00c"},{tag:n.tags.comment,color:"#940"},{tag:n.tags.invalid,color:"#f00"}]),Tt=r.EditorView.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),Pt="()[]{}",At=e.Facet.define({combine:t=>e.combineConfig(t,{afterCursor:!0,brackets:Pt,maxScanDistance:1e4,renderMatch:It})}),Ct=r.Decoration.mark({class:"cm-matchingBracket"}),Dt=r.Decoration.mark({class:"cm-nonmatchingBracket"});function It(t){let e=[],r=t.matched?Ct:Dt;return e.push(r.range(t.start.from,t.start.to)),t.end&&e.push(r.range(t.end.from,t.end.to)),e}const Nt=[e.StateField.define({create:()=>r.Decoration.none,update(t,e){if(!e.docChanged&&!e.selection)return t;let n=[],s=e.state.facet(At);for(let t of e.state.selection.ranges){if(!t.empty)continue;let r=Lt(e.state,t.head,-1,s)||t.head>0&&Lt(e.state,t.head-1,1,s)||s.afterCursor&&(Lt(e.state,t.head,1,s)||t.head<e.state.doc.length&&Lt(e.state,t.head+1,-1,s));r&&(n=n.concat(s.renderMatch(r,e.state)))}return r.Decoration.set(n,!0)},provide:t=>r.EditorView.decorations.from(t)}),Tt];const Et=new t.NodeProp;function Ot(e,r,n){let s=e.prop(r<0?t.NodeProp.openedBy:t.NodeProp.closedBy);if(s)return s;if(1==e.name.length){let t=n.indexOf(e.name);if(t>-1&&t%2==(r<0?1:0))return[n[t+r]]}return null}function Bt(t){let e=t.type.prop(Et);return e?e(t.node):t}function Lt(t,e,r,n={}){let s=n.maxScanDistance||1e4,o=n.brackets||Pt,i=k(t),a=i.resolveInner(e,r);for(let n=a;n;n=n.parent){let s=Ot(n.type,r,o);if(s&&n.from<n.to){let i=Bt(n);if(i&&(r>0?e>=i.from&&e<i.to:e>i.from&&e<=i.to))return Rt(t,e,r,n,i,s,o)}}return function(t,e,r,n,s,o,i){let a=r<0?t.sliceDoc(e-1,e):t.sliceDoc(e,e+1),l=i.indexOf(a);if(l<0||l%2==0!=r>0)return null;let h={from:r<0?e-1:e,to:r>0?e+1:e},u=t.doc.iterRange(e,r>0?t.doc.length:0),c=0;for(let t=0;!u.next().done&&t<=o;){let o=u.value;r<0&&(t+=o.length);let a=e+t*r;for(let t=r>0?0:o.length-1,e=r>0?o.length:-1;t!=e;t+=r){let e=i.indexOf(o[t]);if(!(e<0||n.resolveInner(a+t,1).type!=s))if(e%2==0==r>0)c++;else{if(1==c)return{start:h,end:{from:a+t,to:a+t+1},matched:e>>1==l>>1};c--}}r>0&&(t+=o.length)}return u.done?{start:h,matched:!1}:null}(t,e,r,i,a.type,s,o)}function Rt(t,e,r,n,s,o,i){let a=n.parent,l={from:s.from,to:s.to},h=0,u=null==a?void 0:a.cursor();if(u&&(r<0?u.childBefore(n.from):u.childAfter(n.to)))do{if(r<0?u.to<=n.from:u.from>=n.to){if(0==h&&o.indexOf(u.type.name)>-1&&u.from<u.to){let t=Bt(u);return{start:l,end:t?{from:t.from,to:t.to}:void 0,matched:!0}}if(Ot(u.type,r,i))h++;else if(Ot(u.type,-r,i)){if(0==h){let t=Bt(u);return{start:l,end:t&&t.from<t.to?{from:t.from,to:t.to}:void 0,matched:!1}}h--}}}while(r<0?u.prevSibling():u.nextSibling());return{start:l,matched:!1}}function Mt(t,e,r,n=0,s=0){null==e&&-1==(e=t.search(/[^\s\u00a0]/))&&(e=t.length);let o=s;for(let s=n;s<e;s++)9==t.charCodeAt(s)?o+=r-o%r:o++;return o}class Ft{constructor(t,e,r,n){this.string=t,this.tabSize=e,this.indentUnit=r,this.overrideIndent=n,this.pos=0,this.start=0,this.lastColumnPos=0,this.lastColumnValue=0}eol(){return this.pos>=this.string.length}sol(){return 0==this.pos}peek(){return this.string.charAt(this.pos)||void 0}next(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)}eat(t){let e,r=this.string.charAt(this.pos);if(e="string"==typeof t?r==t:r&&(t instanceof RegExp?t.test(r):t(r)),e)return++this.pos,r}eatWhile(t){let e=this.pos;for(;this.eat(t););return this.pos>e}eatSpace(){let t=this.pos;for(;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>t}skipToEnd(){this.pos=this.string.length}skipTo(t){let e=this.string.indexOf(t,this.pos);if(e>-1)return this.pos=e,!0}backUp(t){this.pos-=t}column(){return this.lastColumnPos<this.start&&(this.lastColumnValue=Mt(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue}indentation(){var t;return null!==(t=this.overrideIndent)&&void 0!==t?t:Mt(this.string,null,this.tabSize)}match(t,e,r){if("string"==typeof t){let n=t=>r?t.toLowerCase():t;return n(this.string.substr(this.pos,t.length))==n(t)?(!1!==e&&(this.pos+=t.length),!0):null}{let r=this.string.slice(this.pos).match(t);return r&&r.index>0?null:(r&&!1!==e&&(this.pos+=r[0].length),r)}}current(){return this.string.slice(this.start,this.pos)}}function Vt(t){if("object"!=typeof t)return t;let e={};for(let r in t){let n=t[r];e[r]=n instanceof Array?n.slice():n}return e}const jt=new WeakMap;class Wt extends p{constructor(e){let r,n=f(e.languageData),s={name:(o=e).name||"",token:o.token,blankLine:o.blankLine||(()=>{}),startState:o.startState||(()=>!0),copyState:o.copyState||Vt,indent:o.indent||(()=>null),languageData:o.languageData||{},tokenTable:o.tokenTable||Ht,mergeTokens:!1!==o.mergeTokens};var o;super(n,new class extends t.Parser{createParse(t,e,n){return new zt(r,t,e,n)}},[],e.name),this.topNode=function(e,r){let n=t.NodeType.define({id:Gt.length,name:"Document",props:[c.add(()=>e),R.add(()=>t=>r.getIndent(t))],top:!0});return Gt.push(n),n}(n,this),r=this,this.streamParser=s,this.stateAfter=new t.NodeProp({perNode:!0}),this.tokenTable=e.tokenTable?new Qt(s.tokenTable):Xt}static define(t){return new Wt(t)}getIndent(t){let e,{overrideIndentation:r}=t.options;r&&(e=jt.get(t.state),null!=e&&e<t.pos-1e4&&(e=void 0));let n,s,o=Ut(this,t.node.tree,t.node.from,t.node.from,null!=e?e:t.pos);if(o?(s=o.state,n=o.pos+1):(s=this.streamParser.startState(t.unit),n=t.node.from),t.pos-n>1e4)return null;for(;n<t.pos;){let e=t.state.doc.lineAt(n),o=Math.min(t.pos,e.to);if(e.length){let n=r?r(e.from):-1,i=new Ft(e.text,t.state.tabSize,t.unit,n<0?void 0:n);for(;i.pos<o-e.from;)qt(this.streamParser.token,i,s)}else this.streamParser.blankLine(s,t.unit);if(o==t.pos)break;n=e.to+1}let i=t.lineAt(t.pos);return r&&null==e&&jt.set(t.state,i.from),this.streamParser.indent(s,/^\s*(.*)/.exec(i.text)[1],t)}get allowsNesting(){return!1}}function Ut(e,r,n,s,o){let i=n>=s&&n+r.length<=o&&r.prop(e.stateAfter);if(i)return{state:e.streamParser.copyState(i),pos:n+r.length};for(let i=r.children.length-1;i>=0;i--){let a=r.children[i],l=n+r.positions[i],h=a instanceof t.Tree&&l<o&&Ut(e,a,l,s,o);if(h)return h}return null}function $t(e,r,n,s,o){if(o&&n<=0&&s>=r.length)return r;o||0!=n||r.type!=e.topNode||(o=!0);for(let i=r.children.length-1;i>=0;i--){let a,l=r.positions[i],h=r.children[i];if(l<s&&h instanceof t.Tree){if(!(a=$t(e,h,n-l,s-l,o)))break;return o?new t.Tree(r.type,r.children.slice(0,i).concat(a),r.positions.slice(0,i+1),l+a.length):a}}return null}class zt{constructor(e,r,n,s){this.lang=e,this.input=r,this.fragments=n,this.ranges=s,this.stoppedAt=null,this.chunks=[],this.chunkPos=[],this.chunk=[],this.chunkReused=void 0,this.rangeIndex=0,this.to=s[s.length-1].to;let o=y.get(),i=s[0].from,{state:a,tree:l}=function(e,r,n,s,o){for(let t of r){let r,o=t.from+(t.openStart?25:0),i=t.to-(t.openEnd?25:0),a=o<=n&&i>n&&Ut(e,t.tree,0-t.offset,n,i);if(a&&a.pos<=s&&(r=$t(e,t.tree,n+t.offset,a.pos+t.offset,!1)))return{state:a.state,tree:r}}return{state:e.streamParser.startState(o?E(o):4),tree:t.Tree.empty}}(e,n,i,this.to,null==o?void 0:o.state);this.state=a,this.parsedPos=this.chunkStart=i+l.length;for(let t=0;t<l.children.length;t++)this.chunks.push(l.children[t]),this.chunkPos.push(l.positions[t]);o&&this.parsedPos<o.viewport.from-1e5&&s.some(t=>t.from<=o.viewport.from&&t.to>=o.viewport.from)&&(this.state=this.lang.streamParser.startState(E(o.state)),o.skipUntilInView(this.parsedPos,o.viewport.from),this.parsedPos=o.viewport.from),this.moveRangeIndex()}advance(){let t=y.get(),e=null==this.stoppedAt?this.to:Math.min(this.to,this.stoppedAt),r=Math.min(e,this.chunkStart+512);for(t&&(r=Math.min(r,t.viewport.to));this.parsedPos<r;)this.parseLine(t);return this.chunkStart<this.parsedPos&&this.finishChunk(),this.parsedPos>=e?this.finish():t&&this.parsedPos>=t.viewport.to?(t.skipUntilInView(this.parsedPos,e),this.finish()):null}stopAt(t){this.stoppedAt=t}lineAfter(t){let e=this.input.chunk(t);if(this.input.lineChunks)"\n"==e&&(e="");else{let t=e.indexOf("\n");t>-1&&(e=e.slice(0,t))}return t+e.length<=this.to?e:e.slice(0,this.to-t)}nextLine(){let t=this.parsedPos,e=this.lineAfter(t),r=t+e.length;for(let t=this.rangeIndex;;){let n=this.ranges[t].to;if(n>=r)break;if(e=e.slice(0,n-(r-e.length)),t++,t==this.ranges.length)break;let s=this.ranges[t].from,o=this.lineAfter(s);e+=o,r=s+o.length}return{line:e,end:r}}skipGapsTo(t,e,r){for(;;){let n=this.ranges[this.rangeIndex].to,s=t+e;if(r>0?n>s:n>=s)break;e+=this.ranges[++this.rangeIndex].from-n}return e}moveRangeIndex(){for(;this.ranges[this.rangeIndex].to<this.parsedPos;)this.rangeIndex++}emitToken(t,e,r,n){let s=4;if(this.ranges.length>1){e+=n=this.skipGapsTo(e,n,1);let t=this.chunk.length;r+=n=this.skipGapsTo(r,n,-1),s+=this.chunk.length-t}let o=this.chunk.length-4;return this.lang.streamParser.mergeTokens&&4==s&&o>=0&&this.chunk[o]==t&&this.chunk[o+2]==e?this.chunk[o+2]=r:this.chunk.push(t,e,r,s),n}parseLine(t){let{line:e,end:r}=this.nextLine(),n=0,{streamParser:s}=this.lang,o=new Ft(e,t?t.state.tabSize:4,t?E(t.state):2);if(o.eol())s.blankLine(this.state,o.indentUnit);else for(;!o.eol();){let t=qt(s.token,o,this.state);if(t&&(n=this.emitToken(this.lang.tokenTable.resolve(t),this.parsedPos+o.start,this.parsedPos+o.pos,n)),o.start>1e4)break}this.parsedPos=r,this.moveRangeIndex(),this.parsedPos<this.to&&this.parsedPos++}finishChunk(){let e=t.Tree.build({buffer:this.chunk,start:this.chunkStart,length:this.parsedPos-this.chunkStart,nodeSet:_t,topID:0,maxBufferLength:512,reused:this.chunkReused});e=new t.Tree(e.type,e.children,e.positions,e.length,[[this.lang.stateAfter,this.lang.streamParser.copyState(this.state)]]),this.chunks.push(e),this.chunkPos.push(this.chunkStart-this.ranges[0].from),this.chunk=[],this.chunkReused=void 0,this.chunkStart=this.parsedPos}finish(){return new t.Tree(this.lang.topNode,this.chunks,this.chunkPos,this.parsedPos-this.ranges[0].from).balance()}}function qt(t,e,r){e.start=e.pos;for(let n=0;n<10;n++){let n=t(e,r);if(e.pos>e.start)return n}throw new Error("Stream parser failed to advance stream.")}const Ht=Object.create(null),Gt=[t.NodeType.none],_t=new t.NodeSet(Gt),Jt=[],Kt=Object.create(null),Zt=Object.create(null);for(let[t,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])Zt[t]=te(Ht,e);class Qt{constructor(t){this.extra=t,this.table=Object.assign(Object.create(null),Zt)}resolve(t){return t?this.table[t]||(this.table[t]=te(this.extra,t)):0}}const Xt=new Qt(Ht);function Yt(t,e){Jt.indexOf(t)>-1||(Jt.push(t),console.warn(e))}function te(e,r){let s=[];for(let t of r.split(" ")){let r=[];for(let s of t.split(".")){let t=e[s]||n.tags[s];t?"function"==typeof t?r.length?r=r.map(t):Yt(s,`Modifier ${s} used at start of tag`):r.length?Yt(s,`Tag ${s} used as modifier`):r=Array.isArray(t)?t:[t]:Yt(s,`Unknown highlighting tag ${s}`)}for(let t of r)s.push(t)}if(!s.length)return 0;let o=r.replace(/ /g,"_"),i=o+" "+s.map(t=>t.id),a=Kt[i];if(a)return a.id;let l=Kt[i]=t.NodeType.define({id:Gt.length,name:o,props:[n.styleTags({[o]:s})]});return Gt.push(l),l.id}function ee(t){return t.length<=4096&&/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/.test(t)}function re(t){for(let e=t.iter();!e.next().done;)if(ee(e.value))return!0;return!1}const ne=e.Facet.define({combine:t=>t.some(t=>t)});const se=r.ViewPlugin.fromClass(class{constructor(t){this.always=t.state.facet(ne)||t.textDirection!=r.Direction.LTR||t.state.facet(r.EditorView.perLineTextDirection),this.hasRTL=!this.always&&re(t.state.doc),this.tree=k(t.state),this.decorations=this.always||this.hasRTL?oe(t,this.tree,this.always):r.Decoration.none}update(t){let e=t.state.facet(ne)||t.view.textDirection!=r.Direction.LTR||t.state.facet(r.EditorView.perLineTextDirection);if(e||this.hasRTL||!function(t){let e=!1;return t.iterChanges((t,r,n,s,o)=>{!e&&re(o)&&(e=!0)}),e}(t.changes)||(this.hasRTL=!0),!e&&!this.hasRTL)return;let n=k(t.state);(e!=this.always||n!=this.tree||t.docChanged||t.viewportChanged)&&(this.tree=n,this.always=e,this.decorations=oe(t.view,n,e))}},{provide:t=>{function n(e){var n,s;return null!==(s=null===(n=e.plugin(t))||void 0===n?void 0:n.decorations)&&void 0!==s?s:r.Decoration.none}return[r.EditorView.outerDecorations.of(n),e.Prec.lowest(r.EditorView.bidiIsolatedRanges.of(n))]}});function oe(r,n,s){let o=new e.RangeSetBuilder,i=r.visibleRanges;s||(i=function(t,e){let r=e.iter(),n=0,s=[],o=null;for(let{from:e,to:i}of t)if(!(o&&o.to>e&&(e=o.to,e>=i)))for(n+r.value.length<e&&(r.next(e-(n+r.value.length)),n=e);;){let t=n,e=n+r.value.length;if(!r.lineBreak&&ee(r.value)&&(o&&o.to>t-10?o.to=Math.min(i,e):s.push(o={from:t,to:Math.min(i,e)})),e>=i)break;n=e,r.next()}return s}(i,r.state.doc));for(let{from:e,to:r}of i)n.iterate({enter:e=>{let r=e.type.prop(t.NodeProp.isolate);r&&o.add(e.from,e.to,ie[r])},from:e,to:r});return o.finish()}const ie={rtl:r.Decoration.mark({class:"cm-iso",inclusive:!0,attributes:{dir:"rtl"},bidiIsolate:r.Direction.RTL}),ltr:r.Decoration.mark({class:"cm-iso",inclusive:!0,attributes:{dir:"ltr"},bidiIsolate:r.Direction.LTR}),auto:r.Decoration.mark({class:"cm-iso",inclusive:!0,attributes:{dir:"auto"},bidiIsolate:null})};exports.DocInput=x,exports.HighlightStyle=kt,exports.IndentContext=L,exports.LRLanguage=m,exports.Language=p,exports.LanguageDescription=D,exports.LanguageSupport=class{constructor(t,e=[]){this.language=t,this.support=e,this.extension=[t,e]}},exports.ParseContext=y,exports.StreamLanguage=Wt,exports.StringStream=Ft,exports.TreeIndentContext=j,exports.bidiIsolates=function(t={}){let e=[se];return t.alwaysIsolate&&e.push(ne.of(!0)),e},exports.bracketMatching=function(t={}){return[At.of(t),Nt]},exports.bracketMatchingHandle=Et,exports.codeFolding=ut,exports.continuedIndent=function({except:t,units:e=1}={}){return r=>{let n=t&&t.test(r.textAfter);return r.baseIndent+(n?0:e*r.unit)}},exports.defaultHighlightStyle=St,exports.defineLanguageFacet=f,exports.delimitedIndent=function({closing:t,align:e=!0,units:r=1}){return n=>U(n,e,r,t)},exports.ensureSyntaxTree=w,exports.flatIndent=t=>t.baseIndent,exports.foldAll=st,exports.foldCode=et,exports.foldEffect=_,exports.foldGutter=function(t={}){let n={...pt,...t},s=new gt(n,!0),o=new gt(n,!1),i=r.ViewPlugin.fromClass(class{constructor(t){this.from=t.viewport.from,this.markers=this.buildMarkers(t)}update(t){(t.docChanged||t.viewportChanged||t.startState.facet(C)!=t.state.facet(C)||t.startState.field(Z,!1)!=t.state.field(Z,!1)||k(t.startState)!=k(t.state)||n.foldingChanged(t))&&(this.markers=this.buildMarkers(t.view))}buildMarkers(t){let r=new e.RangeSetBuilder;for(let e of t.viewportLineBlocks){let n=X(t.state,e.from,e.to)?o:H(t.state,e.from,e.to)?s:null;n&&r.add(e.from,e.from,n)}return r.finish()}}),{domEventHandlers:a}=n;return[i,r.gutter({class:"cm-foldGutter",markers(t){var r;return(null===(r=t.plugin(i))||void 0===r?void 0:r.markers)||e.RangeSet.empty},initialSpacer:()=>new gt(n,!1),domEventHandlers:{...a,click:(t,e,r)=>{if(a.click&&a.click(t,e,r))return!0;let n=X(t.state,e.from,e.to);if(n)return t.dispatch({effects:J.of(n)}),!0;let s=H(t.state,e.from,e.to);return!!s&&(t.dispatch({effects:_.of(s)}),!0)}}}),ut()]},exports.foldInside=function(t){let e=t.firstChild,r=t.lastChild;return e&&e.to<r.from?{from:e.to,to:r.type.isError?t.to:r.from}:null},exports.foldKeymap=at,exports.foldNodeProp=z,exports.foldService=$,exports.foldState=Z,exports.foldable=H,exports.foldedRanges=function(t){return t.field(Z,!1)||e.RangeSet.empty},exports.forceParsing=function(t,e=t.viewport.to,r=100){let n=w(t.state,e,r);return n!=k(t.state)&&t.dispatch({}),!!n},exports.getIndentUnit=E,exports.getIndentation=B,exports.highlightingFor=function(t,e,r){let n=vt(t),s=null;if(n)for(let t of n)if(!t.scope||r&&t.scope(r)){let r=t.style(e);r&&(s=s?s+" "+r:r)}return s},exports.indentNodeProp=R,exports.indentOnInput=function(){return e.EditorState.transactionFilter.of(t=>{if(!t.docChanged||!t.isUserEvent("input.type")&&!t.isUserEvent("input.complete"))return t;let e=t.startState.languageDataAt("indentOnInput",t.startState.selection.main.head);if(!e.length)return t;let r=t.newDoc,{head:n}=t.newSelection.main,s=r.lineAt(n);if(n>s.from+200)return t;let o=r.sliceString(s.from,n);if(!e.some(t=>t.test(o)))return t;let{state:i}=t,a=-1,l=[];for(let{head:t}of i.selection.ranges){let e=i.doc.lineAt(t);if(e.from==a)continue;a=e.from;let r=B(i,e.from);if(null==r)continue;let n=/^\s*/.exec(e.text)[0],s=O(i,r);n!=s&&l.push({from:e.from,to:e.from+n.length,insert:s})}return l.length?[t,{changes:l,sequential:!0}]:t})},exports.indentRange=function(t,e,r){let n=Object.create(null),s=new L(t,{overrideIndentation:t=>{var e;return null!==(e=n[t])&&void 0!==e?e:-1}}),o=[];for(let i=e;i<=r;){let e=t.doc.lineAt(i);i=e.to+1;let r=B(s,e.from);if(null==r)continue;/\S/.test(e.text)||(r=0);let a=/^\s*/.exec(e.text)[0],l=O(t,r);a!=l&&(n[e.from]=r,o.push({from:e.from,to:e.from+a.length,insert:l}))}return t.changes(o)},exports.indentService=I,exports.indentString=O,exports.indentUnit=N,exports.language=C,exports.languageDataProp=c,exports.matchBrackets=Lt,exports.sublanguageProp=d,exports.syntaxHighlighting=function(t,e){let n,s=[bt];return t instanceof kt&&(t.module&&s.push(r.EditorView.styleModule.of(t.module)),n=t.themeType),(null==e?void 0:e.fallback)?s.push(xt.of(t)):n?s.push(wt.computeN([r.EditorView.darkTheme],e=>e.facet(r.EditorView.darkTheme)==("dark"==n)?[t]:[])):s.push(wt.of(t)),s},exports.syntaxParserRunning=function(t){var e;return(null===(e=t.plugin(A))||void 0===e?void 0:e.isWorking())||!1},exports.syntaxTree=k,exports.syntaxTreeAvailable=function(t,e=t.doc.length){var r;return(null===(r=t.field(p.state,!1))||void 0===r?void 0:r.context.isDone(e))||!1},exports.toggleFold=t=>{let e=[];for(let r of K(t)){let n=X(t.state,r.from,r.to);if(n)e.push(J.of(n),nt(t,n,!1));else{let n=it(t,r);n&&e.push(_.of(n),nt(t,n))}}return e.length>0&&t.dispatch({effects:tt(t.state,e)}),!!e.length},exports.unfoldAll=ot,exports.unfoldCode=rt,exports.unfoldEffect=J;
