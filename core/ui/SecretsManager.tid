title: $:/SecretsManager
caption: Secrets Manager

\procedure delete-secret-actions()
<$action-delete-secret $name=<<currentSecret>>/>
<$action-sendmessage $message="tm-notify" $param="$:/language/Notifications/SecretDeleted"/>
\end

\define render-current-secret()
§[secret:$(currentSecret)$]
\end


<div class="tc-secrets-manager">

<h2>🔐 Secrets Manager</h2>

<$let state=<<secrets-state>>>

<!-- State indicator -->
<div class={{{ tc-secrets-state [[tc-secrets-state-]addsuffix<state>] +[join[ ]] }}}>
<%if [<state>match[unencrypted]] %>
⚠️ '''No encryption set up''' - You must set a password to use secrets
<%elseif [<state>match[locked]] %>
🔒 '''Vault locked''' - Enter password to unlock secrets
<%elseif [<state>match[unlocked]] %>
🔓 '''Vault unlocked''' - You can manage secrets
<% endif %>
</div>

<!-- Actions based on state -->
<%if [<state>match[unencrypted]] %>
<div class="tc-secrets-setup">
<p>To use encrypted secrets, you must first set a password for your wiki.</p>
<$button class="tc-btn-big-green">
<$action-setup-secrets/>
{{$:/core/images/locked-padlock}} Set Password
</$button>
</div>
<% endif %>

<%if [<state>match[locked]] %>
<div class="tc-secrets-unlock">
<p>Enter your password to unlock the secrets vault.</p>
<$button class="tc-btn-big-green">
<$action-unlock-secrets/>
{{$:/core/images/unlocked-padlock}} Unlock Vault
</$button>
</div>
<% endif %>

<%if [<state>match[unlocked]] %>
<div class="tc-secrets-unlocked">

<!-- Add new secret -->
<h3>Add New Secret</h3>
<$secret-manager-input/>

<!-- List existing secrets -->
<h3>Existing Secrets</h3>
<$list filter=<<secrets-list>> variable="currentSecret">
<div class="tc-secret-item">
<code class="tc-secret-reference"><<render-current-secret>></code>
<span class="tc-secret-name"><<currentSecret>></span>
<$button actions=<<delete-secret-actions>> class="tc-btn-invisible tc-secret-delete">
{{$:/core/images/delete-button}}
</$button>
</div>
</$list>
<$list filter="[<secrets>count[]match[0]]">
<div class="tc-muted">
No secrets stored yet. Add your first secret above.
</div>
</$list>

</div>
<% endif %>

<!-- Settings section -->
<h3>Settings</h3>
<div class="tc-secrets-settings">
<label>
Auto-lock timeout (minutes): 
<$edit-text tiddler="$:/config/SecretsAutoLockTimeout" tag="input" size="5" placeholder="5"/>
</label>
<div class="tc-muted tc-settings-note">
The vault will automatically lock after this many minutes of inactivity
</div>
<%if [<state>match[unlocked]] %>
<div class="tc-secrets-password-section">
<h4>Change Password</h4>
<p class="tc-muted">Change the password used to encrypt your secrets vault</p>
<$button class="tc-btn-invisible tc-tiddlylink">
<$action-change-password/>
{{$:/core/images/locked-padlock}} Change Vault Password
</$button>
</div>
<% endif %>
</div>

</$let>

</div>

<style>
.tc-secrets-manager {
	padding: 1em;
	max-width: 600px;
}

.tc-secrets-manager h2 {
	margin-top: 0;
	border-bottom: 1px solid <<colour tiddler-border>>;
	padding-bottom: 0.5em;
}

.tc-secrets-state {
	padding: 0.75em;
	margin: 1em 0;
	border-radius: 4px;
	font-weight: 500;
}

.tc-secrets-state-unencrypted {
	background: <<colour notification-background>>;
	color: <<colour notification-foreground>>;
}

.tc-secrets-state-locked {
	background: <<colour message-background>>;
	color: <<colour message-foreground>>;
}

.tc-secrets-state-unlocked {
	background: <<colour tag-background>>;
	color: <<colour tag-foreground>>;
}

.tc-secrets-setup,
.tc-secrets-unlock {
	text-align: center;
	padding: 2em 0;
}

.tc-secret-item {
	display: flex;
	align-items: center;
	gap: 1em;
	padding: 0.5em;
	border-bottom: 1px solid <<colour muted-foreground>>;
}

.tc-secret-item:hover {
	background: <<colour tiddler-background>>;
}

.tc-secret-reference {
	font-size: 0.85em;
	background: <<colour code-background>>;
	color: <<colour code-foreground>>;
	padding: 2px 6px;
	border-radius: 3px;
	white-space: nowrap;
}

/* Ensure code elements inside secret items have proper styling */
.tc-secret-item code {
	background: <<colour code-background>>;
	color: <<colour code-foreground>>;
}

.tc-secret-name {
	flex: 1;
	font-weight: 500;
}

.tc-secret-delete {
	opacity: 0.5;
	transition: opacity 0.2s;
}

.tc-secret-delete:hover {
	opacity: 1;
}

.tc-secrets-settings {
	padding: 1em;
	background: <<colour code-background>>;
	border-radius: 4px;
	margin-top: 1em;
}

.tc-secrets-settings label {
	font-weight: 500;
}

.tc-secrets-settings input {
	margin-left: 0.5em;
	padding: 0.25em;
	border: 1px solid <<colour tiddler-editor-border>>;
	border-radius: 3px;
}

.tc-settings-note {
	font-size: 0.9em;
	margin-top: 0.5em;
}

.tc-secrets-password-section {
	margin-top: 1.5em;
	padding-top: 1em;
	border-top: 1px solid <<colour tiddler-border>>;
}

.tc-secrets-password-section h4 {
	margin-top: 0;
	margin-bottom: 0.5em;
}

.tc-secrets-password-section p {
	margin: 0.5em 0;
}

</style>
