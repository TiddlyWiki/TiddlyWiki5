// Built for tiddlywiki (terser index.cjs --compress ecma=2017 --toplevel --mangle --safari10)
"use strict";const t=Object.freeze({diffTimeout:1,diffEditCost:4,matchThreshold:.5,matchDistance:1e3,patchDeleteThreshold:.5,patchMargin:4,matchMaxBits:32});function n(n){if(n?.__resolved)return n;const e={...t,...n};return Object.defineProperty(e,"__resolved",{value:!0,enumerable:!1}),e}const e=-1;function s(t,n){return[t,n]}function r(t,o,c,u=!0,p){const d=n(c);void 0===p&&(p=d.diffTimeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*d.diffTimeout);const b=p;if(null==t||null==o)throw new Error("Null input. (diff_main)");if(t===o)return t?[s(0,t)]:[];const m=u;let x=g(t,o);const w=t.substring(0,x);x=f(t=t.substring(x),o=o.substring(x));const A=t.substring(t.length-x),$=function(t,n,o,c,u){let p;if(!t)return[s(1,n)];if(!n)return[s(e,t)];const d=t.length>n.length?t:n,b=t.length>n.length?n:t,m=d.indexOf(b);if(-1!==m)return p=[s(1,d.substring(0,m)),s(0,b),s(1,d.substring(m+b.length))],t.length>n.length&&(p[0][0]=p[2][0]=e),p;if(1===b.length)return[s(e,t),s(1,n)];const x=function(t,n,e){if(e.diffTimeout<=0)return null;const s=t.length>n.length?t:n,r=t.length>n.length?n:t;if(s.length<4||2*r.length<s.length)return null;function l(t,n,e){const s=t.substring(e,e+Math.floor(t.length/4));let r,l,i,h,o=-1,a="";for(;-1!==(o=n.indexOf(s,o+1));){const s=g(t.substring(e),n.substring(o)),c=f(t.substring(0,e),n.substring(0,o));a.length<c+s&&(a=n.substring(o-c,o)+n.substring(o,o+s),r=t.substring(0,e-c),l=t.substring(e+s),i=n.substring(0,o-c),h=n.substring(o+s))}return 2*a.length>=t.length?[r,l,i,h,a]:null}const i=l(s,r,Math.ceil(s.length/4)),h=l(s,r,Math.ceil(s.length/2));let o,a,c,u,p;if(!i&&!h)return null;o=h?i&&i[4].length>h[4].length?i:h:i;t.length>n.length?(a=o[0],c=o[1],u=o[2],p=o[3]):(u=o[0],p=o[1],a=o[2],c=o[3]);const d=o[4];return[a,c,u,p,d]}(t,n,o);if(x){const t=x[0],n=x[1],e=x[2],l=x[3],i=x[4],h=r(t,e,o,c,u),g=r(n,l,o,c,u);return h.concat([s(0,i)],g)}return c&&t.length>100&&n.length>100?function(t,n,l,g){const f=i(t,n);t=f.chars1,n=f.chars2;const o=f.lineArray,c=r(t,n,l,!1,g);h(c,o),a(c),c.push(s(0,""));let u=0,p=0,d=0,b="",m="";for(;u<c.length;){switch(c[u][0]){case 1:d++,m+=c[u][1];break;case e:p++,b+=c[u][1];break;case 0:if(p>=1&&d>=1){c.splice(u-p-d,p+d),u=u-p-d;const t=r(b,m,l,!1,g);for(let n=t.length-1;n>=0;n--)c.splice(u,0,t[n]);u+=t.length}d=0,p=0,b="",m=""}u++}return c.pop(),c}(t,n,o,u):function(t,n,r,i){const h=t.length,g=n.length,f=Math.ceil((h+g)/2),o=f,a=2*f,c=new Array(a),u=new Array(a);for(let e=0;e<a;e++)c[e]=-1,u[e]=-1;c[o+1]=0,u[o+1]=0;const p=h-g,d=p%2!=0;let b=0,m=0,x=0,M=0;for(let e=0;e<f&&!((new Date).getTime()>i);e++){for(let s=-e+b;s<=e-m;s+=2){const f=o+s;let x;x=s===-e||s!==e&&c[f-1]<c[f+1]?c[f+1]:c[f-1]+1;let M=x-s;for(;x<h&&M<g&&t.charAt(x)===n.charAt(M);)x++,M++;if(c[f]=x,x>h)m+=2;else if(M>g)b+=2;else if(d){const e=o+p-s;if(e>=0&&e<a&&-1!==u[e]){if(x>=h-u[e])return l(t,n,r,x,M,i)}}}for(let s=-e+x;s<=e-M;s+=2){const f=o+s;let b;b=s===-e||s!==e&&u[f-1]<u[f+1]?u[f+1]:u[f-1]+1;let m=b-s;for(;b<h&&m<g&&t.charAt(h-b-1)===n.charAt(g-m-1);)b++,m++;if(u[f]=b,b>h)M+=2;else if(m>g)x+=2;else if(!d){const e=o+p-s;if(e>=0&&e<a&&-1!==c[e]){const s=c[e];if(b=h-b,s>=b)return l(t,n,r,s,o+s-e,i)}}}}return[s(e,t),s(1,n)]}(t,n,o,u)}(t=t.substring(0,t.length-x),o=o.substring(0,o.length-x),d,m,b);return w&&$.unshift(s(0,w)),A&&$.push(s(0,A)),M($),$}function l(t,n,e,s,l,i){const h=t.substring(0,s),g=n.substring(0,l),f=t.substring(s),o=n.substring(l),a=r(h,g,e,!1,i),c=r(f,o,e,!1,i);return a.concat(c)}function i(t,n){const e=[],s={};let r=4e4;function l(t){let n="",l=0,i=-1,h=e.length;for(;i<t.length-1;){i=t.indexOf("\n",l),-1===i&&(i=t.length-1);let g=t.substring(l,i+1);(s.hasOwnProperty?Object.prototype.hasOwnProperty.call(s,g):void 0!==s[g])?n+=String.fromCharCode(s[g]):(h===r&&(g=t.substring(l),i=t.length),n+=String.fromCharCode(h),s[g]=h,e[h++]=g),l=i+1}return n}e[0]="";const i=l(t);r=65535;return{chars1:i,chars2:l(n),lineArray:e}}function h(t,n){for(let e=0;e<t.length;e++){const s=t[e][1],r=[];for(let t=0;t<s.length;t++)r[t]=n[s.charCodeAt(t)];t[e][1]=r.join("")}}function g(t,n){if(!t||!n||t.charAt(0)!==n.charAt(0))return 0;let e=0,s=Math.min(t.length,n.length),r=s,l=0;for(;e<r;)t.substring(l,r)===n.substring(l,r)?(e=r,l=e):s=r,r=Math.floor((s-e)/2+e);return r}function f(t,n){if(!t||!n||t.charAt(t.length-1)!==n.charAt(n.length-1))return 0;let e=0,s=Math.min(t.length,n.length),r=s,l=0;for(;e<r;)t.substring(t.length-r,t.length-l)===n.substring(n.length-r,n.length-l)?(e=r,l=e):s=r,r=Math.floor((s-e)/2+e);return r}function o(t,n){const e=t.length,s=n.length;if(0===e||0===s)return 0;e>s?t=t.substring(e-s):e<s&&(n=n.substring(0,e));const r=Math.min(e,s);if(t===n)return r;let l=0,i=1;for(;;){const e=t.substring(r-i),s=n.indexOf(e);if(-1===s)return l;i+=s,0!==s&&t.substring(r-i)!==n.substring(0,i)||(l=i,i++)}}function a(t){let n=!1;const r=[];let l=0,i=null,h=0,g=0,f=0,a=0,c=0;for(;h<t.length;)0===t[h][0]?(r[l++]=h,g=a,f=c,a=0,c=0,i=t[h][1]):(1===t[h][0]?a+=t[h][1].length:c+=t[h][1].length,i&&i.length<=Math.max(g,f)&&i.length<=Math.max(a,c)&&(t.splice(r[l-1],0,s(e,i)),t[r[l-1]+1][0]=1,l--,l--,h=l>0?r[l-1]:-1,g=0,f=0,a=0,c=0,i=null,n=!0)),h++;for(n&&M(t),m(t),h=1;h<t.length;){if(t[h-1][0]===e&&1===t[h][0]){const n=t[h-1][1],r=t[h][1],l=o(n,r),i=o(r,n);l>=i?(l>=n.length/2||l>=r.length/2)&&(t.splice(h,0,s(0,r.substring(0,l))),t[h-1][1]=n.substring(0,n.length-l),t[h+1][1]=r.substring(l),h++):(i>=n.length/2||i>=r.length/2)&&(t.splice(h,0,s(0,n.substring(0,i))),t[h-1][0]=1,t[h-1][1]=r.substring(0,r.length-i),t[h+1][0]=e,t[h+1][1]=n.substring(i),h++),h++}h++}}const c=/[^a-z0-9]/i,u=/\s/,p=/[\r\n]/,d=/\n\r?\n$/,b=/^\r?\n\r?\n/;function m(t){function n(t,n){if(!t||!n)return 6;const e=t.charAt(t.length-1),s=n.charAt(0),r=e.match(c),l=s.match(c),i=r&&e.match(u),h=l&&s.match(u),g=i&&e.match(p),f=h&&s.match(p),o=g&&t.match(d),a=f&&n.match(b);return o||a?5:g||f?4:r&&!i&&h?3:i||h?2:r||l?1:0}let e=1;for(;e<t.length-1;){if(0===t[e-1][0]&&0===t[e+1][0]){let s=t[e-1][1],r=t[e][1],l=t[e+1][1];const i=f(s,r);if(i){const t=r.substring(r.length-i);s=s.substring(0,s.length-i),r=t+r.substring(0,r.length-i),l=t+l}let h=s,g=r,o=l,a=n(s,r)+n(r,l);for(;r.charAt(0)===l.charAt(0);){s+=r.charAt(0),r=r.substring(1)+l.charAt(0),l=l.substring(1);const t=n(s,r)+n(r,l);t>=a&&(a=t,h=s,g=r,o=l)}t[e-1][1]!==h&&(h?t[e-1][1]=h:(t.splice(e-1,1),e--),t[e][1]=g,o?t[e+1][1]=o:(t.splice(e+1,1),e--))}e++}}function x(n,r={}){const{diffEditCost:l=t.diffEditCost}=r;let i=!1;const h=[];let g=0,f=null,o=0,a=!1,c=!1,u=!1,p=!1;for(;o<n.length;){if(0===n[o][0])n[o][1].length<l&&(u||p)?(h[g++]=o,a=u,c=p,f=n[o][1]):(g=0,f=null),u=p=!1;else{let t=function(...t){return t.filter(Boolean).length};n[o][0]===e?p=!0:u=!0,f&&(a&&c&&u&&p||f.length<l/2&&3===t(a,c,u,p))&&(n.splice(h[g-1],0,s(e,f)),n[h[g-1]+1][0]=1,g--,f=null,a&&c?(u=p=!0,g=0):(g--,o=g>0?h[g-1]:-1,u=p=!1),i=!0)}o++}i&&M(n)}function M(t){t.push(s(0,""));let n,r=0,l=0,i=0,h="",o="";for(;r<t.length;)switch(t[r][0]){case 1:i++,o+=t[r][1],r++;break;case e:l++,h+=t[r][1],r++;break;case 0:l+i>1?(0!==l&&0!==i&&(n=g(o,h),0!==n&&(r-l-i>0&&0===t[r-l-i-1][0]?t[r-l-i-1][1]+=o.substring(0,n):(t.splice(0,0,s(0,o.substring(0,n))),r++),o=o.substring(n),h=h.substring(n)),n=f(o,h),0!==n&&(t[r][1]=o.substring(o.length-n)+t[r][1],o=o.substring(0,o.length-n),h=h.substring(0,h.length-n))),r-=l+i,t.splice(r,l+i),h.length&&(t.splice(r,0,s(e,h)),r++),o.length&&(t.splice(r,0,s(1,o)),r++),r++):0!==r&&0===t[r-1][0]?(t[r-1][1]+=t[r][1],t.splice(r,1)):r++,i=0,l=0,h="",o=""}""===t[t.length-1][1]&&t.pop();let a=!1;for(r=1;r<t.length-1;)0===t[r-1][0]&&0===t[r+1][0]&&(t[r][1].substring(t[r][1].length-t[r-1][1].length)===t[r-1][1]?(t[r][1]=t[r-1][1]+t[r][1].substring(0,t[r][1].length-t[r-1][1].length),t[r+1][1]=t[r-1][1]+t[r+1][1],t.splice(r-1,1),a=!0):t[r][1].substring(0,t[r+1][1].length)===t[r+1][1]&&(t[r-1][1]+=t[r+1][1],t[r][1]=t[r][1].substring(t[r+1][1].length)+t[r+1][1],t.splice(r+1,1),a=!0)),r++;a&&M(t)}function w(t,n){let s,r=0,l=0,i=0,h=0;for(s=0;s<t.length&&(1!==t[s][0]&&(r+=t[s][1].length),t[s][0]!==e&&(l+=t[s][1].length),!(r>n));s++)i=r,h=l;return t.length!==s&&t[s][0]===e?h:h+(n-i)}function A(t){const n=[];for(let e=0;e<t.length;e++)1!==t[e][0]&&(n[e]=t[e][1]);return n.join("")}function $(t){const n=[];for(let s=0;s<t.length;s++)t[s][0]!==e&&(n[s]=t[s][1]);return n.join("")}function y(t){let n=0,s=0,r=0;for(let l=0;l<t.length;l++){const i=t[l][0],h=t[l][1];switch(i){case 1:s+=h.length;break;case e:r+=h.length;break;case 0:n+=Math.max(s,r),s=0,r=0}}return n+=Math.max(s,r),n}function k(t,n,e,s){if(null==t||null==n||null==e)throw new Error("Null input. (match_main)");return e=Math.max(0,Math.min(e,t.length)),t===n?0:t.length?t.substring(e,e+n.length)===n?e:E(t,n,e,s):-1}function E(t,e,s,r){const l=n(r);if(e.length>l.matchMaxBits)throw new Error("Pattern too long for this browser.");const i=I(e);function h(t,n){const r=t/e.length,i=Math.abs(s-n);return l.matchDistance?r+i/l.matchDistance:i?1:r}let g=l.matchThreshold,f=t.indexOf(e,s);-1!==f&&(g=Math.min(h(0,f),g),f=t.lastIndexOf(e,s+e.length),-1!==f&&(g=Math.min(h(0,f),g)));const o=1<<e.length-1;let a,c;f=-1;let u=e.length+t.length,p=[];for(let n=0;n<e.length;n++){for(a=0,c=u;a<c;)h(n,s+c)<=g?a=c:u=c,c=Math.floor((u-a)/2+a);u=c;let r=Math.max(1,s-c+1);const l=Math.min(s+c,t.length)+e.length,d=new Array(l+2);d[l+1]=(1<<n)-1;for(let e=l;e>=r;e--){const l=i[t.charAt(e-1)];if(d[e]=0===n?(d[e+1]<<1|1)&l:(d[e+1]<<1|1)&l|(p[e+1]|p[e])<<1|1|p[e+1],d[e]&o){const t=h(n,e-1);if(t<=g){if(g=t,f=e-1,!(f>s))break;r=Math.max(1,2*s-f)}}}if(h(n+1,s)>g)break;p=d}return f}function I(t){const n={};for(let e=0;e<t.length;e++)n[t.charAt(e)]=0;for(let e=0;e<t.length;e++)n[t.charAt(e)]|=1<<t.length-e-1;return n}function T(n,e,r){if(0===e.length)return;if(null===n.start2)throw new Error("patch not initialized");const{matchMaxBits:l=t.matchMaxBits,patchMargin:i=t.patchMargin}=r;let h=e.substring(n.start2,n.start2+n.length1),g=0;for(;e.indexOf(h)!==e.lastIndexOf(h)&&h.length<l-i-i;)g+=i,h=e.substring(n.start2-g,n.start2+n.length1+g);g+=i;const f=e.substring(n.start2-g,n.start2);f&&n.diffs.unshift(s(0,f));const o=e.substring(n.start2+n.length1,n.start2+n.length1+g);o&&n.diffs.push(s(0,o)),n.start1-=f.length,n.start2-=f.length,n.length1+=f.length+o.length,n.length2+=f.length+o.length}function C(n,s,l,i={}){const h={...t,...i};let g,f;if("string"==typeof n&&"string"==typeof s&&void 0===l)g=n,f=r(g,s,h,!0),f.length>2&&(a(f),x(f));else if(n&&"object"==typeof n&&void 0===s&&void 0===l)f=n,g=A(f);else if("string"==typeof n&&s&&"object"==typeof s&&void 0===l)g=n,f=s;else{if("string"!=typeof n||"string"!=typeof s||!l||"object"!=typeof l)throw new Error("Unknown call format to patch_make.");g=n,f=l}if(0===f.length)return[];const o=[];let c=O(),u=0,p=0,d=0,b=g,m=g;for(let t=0;t<f.length;t++){const n=f[t][0],s=f[t][1];switch(u||0===n||(c.start1=p,c.start2=d),n){case 1:c.diffs[u++]=f[t],c.length2+=s.length,m=m.substring(0,d)+s+m.substring(d);break;case e:c.length1+=s.length,c.diffs[u++]=f[t],m=m.substring(0,d)+m.substring(d+s.length);break;case 0:s.length<=2*h.patchMargin&&u&&f.length!==t+1?(c.diffs[u++]=f[t],c.length1+=s.length,c.length2+=s.length):s.length>=2*h.patchMargin&&u&&(T(c,b,h),o.push(c),c=O(),u=0,b=m,p=d)}1!==n&&(p+=s.length),n!==e&&(d+=s.length)}return u&&(T(c,b,h),o.push(c)),o}function D(t){const n=[];for(let e=0;e<t.length;e++){const r=t[e],l=O();l.diffs=[];for(let t=0;t<r.diffs.length;t++)l.diffs[t]=s(r.diffs[t][0],r.diffs[t][1]);l.start1=r.start1,l.start2=r.start2,l.length1=r.length1,l.length2=r.length2,n[e]=l}return n}function B(n,e={}){const{patchMargin:r=t.patchMargin}=e;let l="";for(let t=1;t<=r;t++)l+=String.fromCharCode(t);for(let t=0;t<n.length;t++)n[t].start1+=r,n[t].start2+=r;let i=n[0],h=i.diffs;if(0===h.length||0!==h[0][0])h.unshift(s(0,l)),i.start1-=r,i.start2-=r,i.length1+=r,i.length2+=r;else if(r>h[0][1].length){const t=r-h[0][1].length;h[0][1]=l.substring(h[0][1].length)+h[0][1],i.start1-=t,i.start2-=t,i.length1+=t,i.length2+=t}if(i=n[n.length-1],h=i.diffs,0===h.length||0!==h[h.length-1][0])h.push(s(0,l)),i.length1+=r,i.length2+=r;else if(r>h[h.length-1][1].length){const t=r-h[h.length-1][1].length;h[h.length-1][1]+=l.substring(0,t),i.length1+=t,i.length2+=t}return l}function v(t,r){const l=n(r);for(let n=0;n<t.length;n++){if(t[n].length1<=l.matchMaxBits)continue;const r=t[n];t.splice(n--,1);let i=r.start1,h=r.start2,g="";for(;0!==r.diffs.length;){const f=O();let o=!0;for(f.start1=i-g.length,f.start2=h-g.length,""!==g&&(f.length1=f.length2=g.length,f.diffs.push(s(0,g)));0!==r.diffs.length&&f.length1<l.matchMaxBits-l.patchMargin;){const t=r.diffs[0][0];let n=r.diffs[0][1];1===t?(f.length2+=n.length,h+=n.length,f.diffs.push(r.diffs.shift()),o=!1):t===e&&1===f.diffs.length&&0===f.diffs[0][0]&&n.length>2*l.matchMaxBits?(f.length1+=n.length,i+=n.length,o=!1,f.diffs.push(s(t,n)),r.diffs.shift()):(n=n.substring(0,l.matchMaxBits-f.length1-l.patchMargin),f.length1+=n.length,i+=n.length,0===t?(f.length2+=n.length,h+=n.length):o=!1,f.diffs.push(s(t,n)),n===r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(n.length))}g=$(f.diffs),g=g.substring(g.length-l.patchMargin);const a=A(r.diffs).substring(0,l.patchMargin);""!==a&&(f.length1+=a.length,f.length2+=a.length,0!==f.diffs.length&&0===f.diffs[f.diffs.length-1][0]?f.diffs[f.diffs.length-1][1]+=a:f.diffs.push(s(0,a))),o||t.splice(++n,0,f)}}}function O(){const t={diffs:[],start1:null,start2:null,length1:0,length2:0,toString:function(){let t,n;t=0===this.length1?`${this.start1},0`:1===this.length1?this.start1+1:`${this.start1+1},${this.length1}`,n=0===this.length2?`${this.start2},0`:1===this.length2?this.start2+1:`${this.start2+1},${this.length2}`;const s=[`@@ -${t} +${n} @@\n`];let r;for(let l=0;l<this.diffs.length;l++){switch(this.diffs[l][0]){case 1:r="+";break;case e:r="-";break;case 0:r=" "}s[l+1]=`${r+encodeURI(this.diffs[l][1])}\n`}return s.join("").replace(/%20/g," ")}};return t}exports.DIFF_DELETE=e,exports.DIFF_EQUAL=0,exports.DIFF_INSERT=1,exports.defaultOptions=t,exports.diff=r,exports.diffCharsToLines=h,exports.diffCleanupEfficiency=x,exports.diffCleanupMerge=M,exports.diffCleanupSemantic=a,exports.diffCleanupSemanticLossless=m,exports.diffCommonPrefix=g,exports.diffCommonSuffix=f,exports.diffFromDelta=function(t,n){const r=[];let l=0,i=0;const h=n.split(/\t/g);for(let g=0;g<h.length;g++){const n=h[g].substring(1);switch(h[g].charAt(0)){case"+":try{r[l++]=s(1,decodeURI(n))}catch{throw new Error(`Illegal escape in diff_fromDelta: ${n}`)}break;case"-":case"=":{const f=Number.parseInt(n,10);if(Number.isNaN(f)||f<0)throw new Error(`Invalid number in diff_fromDelta: ${n}`);const o=t.substring(i,i+=f);"="===h[g].charAt(0)?r[l++]=s(0,o):r[l++]=s(e,o);break}default:if(h[g])throw new Error(`Invalid diff operation in diff_fromDelta: ${h[g]}`)}}if(i!==t.length)throw new Error(`Delta length (${i}) does not equal source text length (${t.length}).`);return r},exports.diffLevenshtein=y,exports.diffLinesToChars=i,exports.diffMain=r,exports.diffPrettyHtml=function(t){const n=[],s=/&/g,r=/</g,l=/>/g,i=/\n/g;for(let h=0;h<t.length;h++){const g=t[h][0],f=t[h][1].replace(s,"&amp;").replace(r,"&lt;").replace(l,"&gt;").replace(i,"&para;<br>");switch(g){case 1:n[h]=`<ins style="background:#e6ffe6;">${f}</ins>`;break;case e:n[h]=`<del style="background:#ffe6e6;">${f}</del>`;break;case 0:n[h]=`<span>${f}</span>`}}return n.join("")},exports.diffText1=A,exports.diffText2=$,exports.diffToDelta=function(t){const n=[];for(let s=0;s<t.length;s++)switch(t[s][0]){case 1:n[s]=`+${encodeURI(t[s][1])}`;break;case e:n[s]=`-${t[s][1].length}`;break;case 0:n[s]=`=${t[s][1].length}`}return n.join("\t").replace(/%20/g," ")},exports.diffXIndex=w,exports.match=k,exports.matchAlphabet=I,exports.matchBitap=E,exports.matchMain=k,exports.patch=C,exports.patchAddPadding=B,exports.patchApply=function(t,s,l){if(0===t.length)return[s,[]];t=D(t);const i=n(l),h=B(t,i);s=h+s+h,v(t,i);let g=0;const f=[];for(let n=0;n<t.length;n++){const h=t[n].start2+g,o=A(t[n].diffs);let a,c=-1;if(o.length>i.matchMaxBits?(a=k(s,o.substring(0,i.matchMaxBits),h,l),-1!==a&&(c=k(s,o.substring(o.length-i.matchMaxBits),h+o.length-i.matchMaxBits,l),(-1===c||a>=c)&&(a=-1))):a=k(s,o,h,l),-1===a)f[n]=!1,g-=t[n].length2-t[n].length1;else{let u;if(f[n]=!0,g=a-h,u=-1===c?s.substring(a,a+o.length):s.substring(a,c+i.matchMaxBits),o===u)s=s.substring(0,a)+$(t[n].diffs)+s.substring(a+o.length);else{const h=r(o,u,l,!1);if(o.length>i.matchMaxBits&&y(h)/o.length>i.patchDeleteThreshold)f[n]=!1;else{m(h);let r=0,l=0;for(let i=0;i<t[n].diffs.length;i++){const g=t[n].diffs[i];0!==g[0]&&(l=w(h,r)),1===g[0]?s=s.substring(0,a+l)+g[1]+s.substring(a+l):g[0]===e&&(s=s.substring(0,a+l)+s.substring(a+w(h,r+g[1].length))),g[0]!==e&&(r+=g[1].length)}}}}}return[s=s.substring(h.length,s.length-h.length),f]},exports.patchDeepCopy=D,exports.patchFromText=function(t){const n=[];if(!t)return n;const r=t.split("\n");let l=0;const i=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;for(;l<r.length;){const t=r[l].match(i);if(!t)throw new Error(`Invalid patch string: ${r[l]}`);const h=O();for(n.push(h),h.start1=Number.parseInt(t[1],10),""===t[2]?(h.start1--,h.length1=1):"0"===t[2]?h.length1=0:(h.start1--,h.length1=Number.parseInt(t[2],10)),h.start2=Number.parseInt(t[3],10),""===t[4]?(h.start2--,h.length2=1):"0"===t[4]?h.length2=0:(h.start2--,h.length2=Number.parseInt(t[4],10)),l++;l<r.length;){const t=r[l].charAt(0);let n="";try{n=decodeURI(r[l].substring(1))}catch{throw new Error(`Illegal escape in patch_fromText: ${n}`)}if("-"===t)h.diffs.push(s(e,n));else if("+"===t)h.diffs.push(s(1,n));else if(" "===t)h.diffs.push(s(0,n));else{if("@"===t)break;if(""!==t)throw new Error(`Invalid patch mode "${t}" in: ${n}`)}l++}}return n},exports.patchMake=C,exports.patchSplitMax=v,exports.patchToText=function(t){const n=[];for(let e=0;e<t.length;e++)n[e]=t[e];return n.join("")},exports.resolveOptions=n;